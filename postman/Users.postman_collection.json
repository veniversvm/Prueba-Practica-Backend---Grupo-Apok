{
  "info": {
    "_postman_id": "e4648d96-900c-4844-95d3-cfe8be7099ef",
    "name": "Users",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "52193681",
    "_collection_link": "https://go.postman.co/collection/52193681-e4648d96-900c-4844-95d3-cfe8be7099ef?source=collection_link"
  },
  "item": [
    {
      "name": "Get_Users_Actives",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login y obtenci√≥n de tokens ===\");",
              "",
              "// Configuraci√≥n b√°sica",
              "const baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"LOCAL\");",
              "const username = pm.environment.get(\"SUDOUSERNAME\") || pm.globals.get(\"SUDOUSERNAME\");",
              "const password = pm.environment.get(\"SUDOUSERPASS\") || pm.globals.get(\"SUDOUSERPASS\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(\"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\");",
              "}",
              "if (!username || !password) {",
              "    throw new Error(\"Variables SUDOUSERNAME o SUDOUSERPASS no est√°n definidas.\");",
              "}",
              "",
              "const loginUrl = baseUrl.replace(/\\/+$/, \"\") + \"/token/\"; // o \"/api/token/\" seg√∫n tu backend",
              "",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: username,",
              "            password: password",
              "        })",
              "    }",
              "};",
              "",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login:\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login:\", loginData);",
              "        throw new Error(\"La respuesta de login no contiene 'access' y/o 'refresh'.\");",
              "    }",
              "",
              "    // Guardar tokens para otros requests, si los necesitas",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    // Asegurar solo headers, NO tocar el body",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // ‚ö† NO actualizar el body aqu√≠, dejamos el body inv√°lido que seteaste t√∫ a mano",
              "    // pm.request.body.update({ ... });",
              "",
              "    console.log(\"‚úì Login OK. Usando body de refresh tal como est√° configurado en el request (deber√≠a ser inv√°lido).\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// ============================================",
              "// TEST: Listar usuarios filtrados por is_active=true",
              "// Endpoint: GET /api/users/?is_active=true",
              "// ============================================",
              "",
              "console.log(\"=== Test: Usuarios activos (is_active=true) ===\");",
              "",
              "// 1. Verificar status code 200 OK",
              "pm.test(\"Status code es 200 OK\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "// 2. Parsear respuesta JSON",
              "let responseData = null;",
              "try {",
              "    responseData = pm.response.json();",
              "    pm.test(\"Respuesta es JSON v√°lido\", function () {",
              "        pm.expect(responseData).to.be.an(\"array\");",
              "    });",
              "} catch (e) {",
              "    pm.test(\"Respuesta es JSON v√°lido\", function () {",
              "        pm.expect.fail(\"La respuesta no es JSON v√°lido: \" + e.message);",
              "    });",
              "}",
              "",
              "// 3. DEBUG: Mostrar informaci√≥n del request",
              "const requestUrl = pm.request.url.toString();",
              "console.log(`DEBUG - URL solicitada: ${requestUrl}`);",
              "console.log(`DEBUG - Query param: is_active=true`);",
              "",
              "// 4. Verificar que es un array",
              "if (responseData) {",
              "    pm.test(\"Respuesta es un array\", function () {",
              "        pm.expect(Array.isArray(responseData)).to.be.true;",
              "    });",
              "    ",
              "    console.log(`‚úÖ Usuarios encontrados con filtro: ${responseData.length}`);",
              "    ",
              "    // 5. Si hay usuarios, verificar estructura",
              "    if (responseData.length > 0) {",
              "        const firstUser = responseData[0];",
              "        ",
              "        // 6. Verificar estructura b√°sica",
              "        pm.test(\"Usuarios tienen estructura correcta\", function () {",
              "            pm.expect(firstUser).to.include.all.keys([",
              "                \"id\",",
              "                \"username\",",
              "                \"email\",",
              "                \"role\",",
              "                \"is_email_confirmed\",",
              "                \"is_active\",",
              "                \"date_joined\"",
              "            ]);",
              "        });",
              "        ",
              "        // 7. VERIFICACI√ìN CR√çTICA: Todos deben tener is_active = true",
              "        pm.test(\"TODOS los usuarios tienen is_active = true\", function () {",
              "            const allActive = responseData.every(user => user.is_active === true);",
              "            pm.expect(allActive).to.be.true;",
              "            console.log(`‚úÖ Verificado: ${responseData.length} usuarios activos`);",
              "        });",
              "        ",
              "        // 8. Verificar que no hay usuarios con is_active = false",
              "        const inactiveUsers = responseData.filter(user => user.is_active === false);",
              "        pm.test(\"No hay usuarios inactivos en la respuesta\", function () {",
              "            pm.expect(inactiveUsers.length).to.equal(0);",
              "            if (inactiveUsers.length > 0) {",
              "                console.log(`‚ùå ERROR: Se encontraron ${inactiveUsers.length} usuarios inactivos`);",
              "                inactiveUsers.forEach(user => {",
              "                    console.log(`   - ${user.username} (ID: ${user.id}) est√° inactivo`);",
              "                });",
              "            }",
              "        });",
              "        ",
              "        // 9. An√°lisis estad√≠stico",
              "        const rolesCount = {};",
              "        const confirmedCount = responseData.filter(user => user.is_email_confirmed).length;",
              "        ",
              "        responseData.forEach(user => {",
              "            rolesCount[user.role] = (rolesCount[user.role] || 0) + 1;",
              "        });",
              "        ",
              "        console.log(\"\\nüìä ESTAD√çSTICAS DE USUARIOS ACTIVOS:\");",
              "        console.log(`   Total activos: ${responseData.length}`);",
              "        console.log(`   Confirmados: ${confirmedCount} (${Math.round(confirmedCount/responseData.length*100)}%)`);",
              "        ",
              "        Object.entries(rolesCount).forEach(([role, count]) => {",
              "            console.log(`   ${role}: ${count} usuarios`);",
              "        });",
              "        ",
              "        // 10. Verificar algunos usuarios espec√≠ficos del seeder que deber√≠an estar activos",
              "        const expectedActiveUsers = [",
              "            \"admin_boss\",      // ADMIN confirmado",
              "            \"user_regular\",    // USER confirmado  ",
              "            \"staff_dev\"        // ADMIN confirmado",
              "        ];",
              "        ",
              "        const foundActiveUsers = responseData.filter(user => ",
              "            expectedActiveUsers.includes(user.username)",
              "        );",
              "        ",
              "        console.log(`\\nüîç Usuarios activos esperados encontrados: ${foundActiveUsers.length}/${expectedActiveUsers.length}`);",
              "        foundActiveUsers.forEach(user => {",
              "            console.log(`   ‚úÖ ${user.username}: ${user.role} (confirmado: ${user.is_email_confirmed})`);",
              "        });",
              "        ",
              "        // 11. Verificar usuarios que NO deber√≠an aparecer (inactivos)",
              "        const expectedInactiveUsers = [",
              "            \"admin_pending\",   // ADMIN NO confirmado (¬øestar√° inactivo?)",
              "            \"user_new\"         // USER NO confirmado (¬øestar√° inactivo?)",
              "        ];",
              "        ",
              "        const foundInactiveUsers = responseData.filter(user => ",
              "            expectedInactiveUsers.includes(user.username)",
              "        );",
              "        ",
              "        if (foundInactiveUsers.length > 0) {",
              "            console.log(`\\n‚ö† Usuarios inactivos que APARECEN (puede ser normal):`);",
              "            foundInactiveUsers.forEach(user => {",
              "                console.log(`   ‚ö† ${user.username}: activo=${user.is_active}, confirmado=${user.is_email_confirmed}`);",
              "            });",
              "        } else {",
              "            console.log(`\\n‚úÖ Usuarios inactivos correctamente filtrados`);",
              "        }",
              "        ",
              "        // 12. Mostrar primeros usuarios como ejemplo",
              "        console.log(\"\\nüë• Primeros usuarios activos:\");",
              "        responseData.slice(0, 3).forEach((user, i) => {",
              "            console.log(`   ${i+1}. ${user.username} (${user.role}) - √öltimo login: ${user.last_login || 'Nunca'}`);",
              "        });",
              "        ",
              "    } else {",
              "        console.log(\"‚ö† Array de usuarios activos est√° vac√≠o\");",
              "        pm.test(\"Array puede estar vac√≠o\", function () {",
              "            pm.expect(responseData.length).to.equal(0);",
              "        });",
              "    }",
              "}",
              "",
              "// 13. Comparar con lista completa (si tenemos datos previos)",
              "const totalUsersCount = pm.environment.get(\"total_users_count\");",
              "if (totalUsersCount && responseData) {",
              "    const total = parseInt(totalUsersCount);",
              "    const active = responseData.length;",
              "    const inactiveCount = total - active;",
              "    ",
              "    console.log(`\\nüìà COMPARACI√ìN CON TOTAL DE USUARIOS:`);",
              "    console.log(`   Total usuarios: ${total}`);",
              "    console.log(`   Usuarios activos: ${active} (${Math.round(active/total*100)}%)`);",
              "    console.log(`   Usuarios inactivos: ${inactiveCount} (${Math.round(inactiveCount/total*100)}%)`);",
              "}",
              "",
              "// 14. Verificar headers de respuesta",
              "pm.test(\"Headers de respuesta correctos\", function () {",
              "    const contentType = pm.response.headers.get(\"Content-Type\");",
              "    pm.expect(contentType).to.include(\"application/json\");",
              "});",
              "",
              "// 15. Verificar tiempo de respuesta",
              "pm.test(\"Tiempo de respuesta aceptable\", function () {",
              "    pm.expect(pm.response.responseTime).to.be.below(1000);",
              "    console.log(`‚úÖ Tiempo de respuesta: ${pm.response.responseTime}ms`);",
              "});",
              "",
              "// 16. Test de integridad del filtrado",
              "pm.test(\"Integridad del filtrado por is_active\", function () {",
              "    const criticalChecks = [",
              "        { name: \"Status 200\", check: pm.response.code === 200 },",
              "        { name: \"Es array JSON\", check: responseData !== null && Array.isArray(responseData) },",
              "        { name: \"Todos activos\", check: responseData.length === 0 || ",
              "            responseData.every(user => user.is_active === true) }",
              "    ];",
              "    ",
              "    let allPassed = true;",
              "    criticalChecks.forEach(check => {",
              "        console.log(`${check.name}: ${check.check ? '‚úÖ' : '‚ùå'}`);",
              "        if (!check.check) allPassed = false;",
              "    });",
              "    ",
              "    pm.expect(allPassed, \"Fallo una verificaci√≥n cr√≠tica del filtrado\").to.be.true;",
              "    console.log(\"‚úÖ Todas las verificaciones cr√≠ticas pasaron\");",
              "});",
              "",
              "// 17. Guardar informaci√≥n para tests futuros",
              "if (responseData && responseData.length > 0) {",
              "    pm.environment.set(\"active_users_count\", responseData.length.toString());",
              "    ",
              "    // Encontrar y guardar un usuario activo espec√≠fico",
              "    const activeAdmin = responseData.find(user => user.role === \"ADMIN\" && user.is_email_confirmed);",
              "    if (activeAdmin) {",
              "        pm.environment.set(\"active_admin_id\", activeAdmin.id.toString());",
              "        pm.environment.set(\"active_admin_username\", activeAdmin.username);",
              "    }",
              "    ",
              "    const activeUser = responseData.find(user => user.role === \"USER\" && user.is_email_confirmed);",
              "    if (activeUser) {",
              "        pm.environment.set(\"active_user_id\", activeUser.id.toString());",
              "        pm.environment.set(\"active_user_username\", activeUser.username);",
              "    }",
              "}",
              "",
              "// 18. RESUMEN FINAL",
              "console.log(\"\\n\" + \"=\".repeat(60));",
              "console.log(\"‚úÖ FILTRADO POR is_active=true COMPLETADO\");",
              "console.log(\"=\".repeat(60));",
              "console.log(`Resultado: ${responseData ? responseData.length : 0} usuarios activos`);",
              "console.log(`Filtro aplicado correctamente: ‚úÖ`);",
              "console.log(\"=\".repeat(60));",
              "",
              "console.log(\"=== Test de filtrado por is_active completado ===\");"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": ""
        },
        "url": {
          "raw": "{{LOCAL}}/users/?is_active=true",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            ""
          ],
          "query": [
            {
              "key": "is_active",
              "value": "true"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Get_Users_Must_Fail",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login y obtenci√≥n de tokens ===\");",
              "",
              "// Configuraci√≥n b√°sica",
              "const baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"LOCAL\");",
              "const username = pm.environment.get(\"SUDOUSERNAME\") || pm.globals.get(\"SUDOUSERNAME\");",
              "const password = pm.environment.get(\"SUDOUSERPASS\") || pm.globals.get(\"SUDOUSERPASS\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(\"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\");",
              "}",
              "if (!username || !password) {",
              "    throw new Error(\"Variables SUDOUSERNAME o SUDOUSERPASS no est√°n definidas.\");",
              "}",
              "",
              "const loginUrl = baseUrl.replace(/\\/+$/, \"\") + \"/token/\"; // o \"/api/token/\" seg√∫n tu backend",
              "",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: username,",
              "            password: password",
              "        })",
              "    }",
              "};",
              "",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login:\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login:\", loginData);",
              "        throw new Error(\"La respuesta de login no contiene 'access' y/o 'refresh'.\");",
              "    }",
              "",
              "    // Guardar tokens para otros requests, si los necesitas",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    // Asegurar solo headers, NO tocar el body",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // ‚ö† NO actualizar el body aqu√≠, dejamos el body inv√°lido que seteaste t√∫ a mano",
              "    // pm.request.body.update({ ... });",
              "",
              "    console.log(\"‚úì Login OK. Usando body de refresh tal como est√° configurado en el request (deber√≠a ser inv√°lido).\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": ""
        },
        "url": {
          "raw": "{{LOCAL}}/users/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            ""
          ]
        }
      },
      "response": []
    },
    {
      "name": "Get_Users_InActives",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login y obtenci√≥n de tokens ===\");",
              "",
              "// Configuraci√≥n b√°sica",
              "const baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"LOCAL\");",
              "const username = pm.environment.get(\"SUDOUSERNAME\") || pm.globals.get(\"SUDOUSERNAME\");",
              "const password = pm.environment.get(\"SUDOUSERPASS\") || pm.globals.get(\"SUDOUSERPASS\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(\"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\");",
              "}",
              "if (!username || !password) {",
              "    throw new Error(\"Variables SUDOUSERNAME o SUDOUSERPASS no est√°n definidas.\");",
              "}",
              "",
              "const loginUrl = baseUrl.replace(/\\/+$/, \"\") + \"/token/\"; // o \"/api/token/\" seg√∫n tu backend",
              "",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: username,",
              "            password: password",
              "        })",
              "    }",
              "};",
              "",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login:\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login:\", loginData);",
              "        throw new Error(\"La respuesta de login no contiene 'access' y/o 'refresh'.\");",
              "    }",
              "",
              "    // Guardar tokens para otros requests, si los necesitas",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    // Asegurar solo headers, NO tocar el body",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // ‚ö† NO actualizar el body aqu√≠, dejamos el body inv√°lido que seteaste t√∫ a mano",
              "    // pm.request.body.update({ ... });",
              "",
              "    console.log(\"‚úì Login OK. Usando body de refresh tal como est√° configurado en el request (deber√≠a ser inv√°lido).\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// ============================================",
              "// TEST: Listar usuarios filtrados por is_active=true",
              "// Endpoint: GET /api/users/?is_active=true",
              "// ============================================",
              "",
              "console.log(\"=== Test: Usuarios activos (is_active=true) ===\");",
              "",
              "// 1. Verificar status code 200 OK",
              "pm.test(\"Status code es 200 OK\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "// 2. Parsear respuesta JSON",
              "let responseData = null;",
              "try {",
              "    responseData = pm.response.json();",
              "    pm.test(\"Respuesta es JSON v√°lido\", function () {",
              "        pm.expect(responseData).to.be.an(\"array\");",
              "    });",
              "} catch (e) {",
              "    pm.test(\"Respuesta es JSON v√°lido\", function () {",
              "        pm.expect.fail(\"La respuesta no es JSON v√°lido: \" + e.message);",
              "    });",
              "}",
              "",
              "// 3. DEBUG: Mostrar informaci√≥n del request",
              "const requestUrl = pm.request.url.toString();",
              "console.log(`DEBUG - URL solicitada: ${requestUrl}`);",
              "console.log(`DEBUG - Query param: is_active=true`);",
              "",
              "// 4. Verificar que es un array",
              "if (responseData) {",
              "    pm.test(\"Respuesta es un array\", function () {",
              "        pm.expect(Array.isArray(responseData)).to.be.true;",
              "    });",
              "    ",
              "    console.log(`‚úÖ Usuarios encontrados con filtro: ${responseData.length}`);",
              "    ",
              "    // 5. Si hay usuarios, verificar estructura",
              "    if (responseData.length > 0) {",
              "        const firstUser = responseData[0];",
              "        ",
              "        // 6. Verificar estructura b√°sica",
              "        pm.test(\"Usuarios tienen estructura correcta\", function () {",
              "            pm.expect(firstUser).to.include.all.keys([",
              "                \"id\",",
              "                \"username\",",
              "                \"email\",",
              "                \"role\",",
              "                \"is_email_confirmed\",",
              "                \"is_active\",",
              "                \"date_joined\"",
              "            ]);",
              "        });",
              "        ",
              "        // 7. VERIFICACI√ìN CR√çTICA: Todos deben tener is_active = true",
              "        pm.test(\"TODOS los usuarios tienen is_active = true\", function () {",
              "            const allActive = responseData.every(user => user.is_active === true);",
              "            pm.expect(allActive).to.be.true;",
              "            console.log(`‚úÖ Verificado: ${responseData.length} usuarios activos`);",
              "        });",
              "        ",
              "        // 8. Verificar que no hay usuarios con is_active = false",
              "        const inactiveUsers = responseData.filter(user => user.is_active === false);",
              "        pm.test(\"No hay usuarios inactivos en la respuesta\", function () {",
              "            pm.expect(inactiveUsers.length).to.equal(0);",
              "            if (inactiveUsers.length > 0) {",
              "                console.log(`‚ùå ERROR: Se encontraron ${inactiveUsers.length} usuarios inactivos`);",
              "                inactiveUsers.forEach(user => {",
              "                    console.log(`   - ${user.username} (ID: ${user.id}) est√° inactivo`);",
              "                });",
              "            }",
              "        });",
              "        ",
              "        // 9. An√°lisis estad√≠stico",
              "        const rolesCount = {};",
              "        const confirmedCount = responseData.filter(user => user.is_email_confirmed).length;",
              "        ",
              "        responseData.forEach(user => {",
              "            rolesCount[user.role] = (rolesCount[user.role] || 0) + 1;",
              "        });",
              "        ",
              "        console.log(\"\\nüìä ESTAD√çSTICAS DE USUARIOS ACTIVOS:\");",
              "        console.log(`   Total activos: ${responseData.length}`);",
              "        console.log(`   Confirmados: ${confirmedCount} (${Math.round(confirmedCount/responseData.length*100)}%)`);",
              "        ",
              "        Object.entries(rolesCount).forEach(([role, count]) => {",
              "            console.log(`   ${role}: ${count} usuarios`);",
              "        });",
              "        ",
              "        // 10. Verificar algunos usuarios espec√≠ficos del seeder que deber√≠an estar activos",
              "        const expectedActiveUsers = [",
              "            \"admin_boss\",      // ADMIN confirmado",
              "            \"user_regular\",    // USER confirmado  ",
              "            \"staff_dev\"        // ADMIN confirmado",
              "        ];",
              "        ",
              "        const foundActiveUsers = responseData.filter(user => ",
              "            expectedActiveUsers.includes(user.username)",
              "        );",
              "        ",
              "        console.log(`\\nüîç Usuarios activos esperados encontrados: ${foundActiveUsers.length}/${expectedActiveUsers.length}`);",
              "        foundActiveUsers.forEach(user => {",
              "            console.log(`   ‚úÖ ${user.username}: ${user.role} (confirmado: ${user.is_email_confirmed})`);",
              "        });",
              "        ",
              "        // 11. Verificar usuarios que NO deber√≠an aparecer (inactivos)",
              "        const expectedInactiveUsers = [",
              "            \"admin_pending\",   // ADMIN NO confirmado (¬øestar√° inactivo?)",
              "            \"user_new\"         // USER NO confirmado (¬øestar√° inactivo?)",
              "        ];",
              "        ",
              "        const foundInactiveUsers = responseData.filter(user => ",
              "            expectedInactiveUsers.includes(user.username)",
              "        );",
              "        ",
              "        if (foundInactiveUsers.length > 0) {",
              "            console.log(`\\n‚ö† Usuarios inactivos que APARECEN (puede ser normal):`);",
              "            foundInactiveUsers.forEach(user => {",
              "                console.log(`   ‚ö† ${user.username}: activo=${user.is_active}, confirmado=${user.is_email_confirmed}`);",
              "            });",
              "        } else {",
              "            console.log(`\\n‚úÖ Usuarios inactivos correctamente filtrados`);",
              "        }",
              "        ",
              "        // 12. Mostrar primeros usuarios como ejemplo",
              "        console.log(\"\\nüë• Primeros usuarios activos:\");",
              "        responseData.slice(0, 3).forEach((user, i) => {",
              "            console.log(`   ${i+1}. ${user.username} (${user.role}) - √öltimo login: ${user.last_login || 'Nunca'}`);",
              "        });",
              "        ",
              "    } else {",
              "        console.log(\"‚ö† Array de usuarios activos est√° vac√≠o\");",
              "        pm.test(\"Array puede estar vac√≠o\", function () {",
              "            pm.expect(responseData.length).to.equal(0);",
              "        });",
              "    }",
              "}",
              "",
              "// 13. Comparar con lista completa (si tenemos datos previos)",
              "const totalUsersCount = pm.environment.get(\"total_users_count\");",
              "if (totalUsersCount && responseData) {",
              "    const total = parseInt(totalUsersCount);",
              "    const active = responseData.length;",
              "    const inactiveCount = total - active;",
              "    ",
              "    console.log(`\\nüìà COMPARACI√ìN CON TOTAL DE USUARIOS:`);",
              "    console.log(`   Total usuarios: ${total}`);",
              "    console.log(`   Usuarios activos: ${active} (${Math.round(active/total*100)}%)`);",
              "    console.log(`   Usuarios inactivos: ${inactiveCount} (${Math.round(inactiveCount/total*100)}%)`);",
              "}",
              "",
              "// 14. Verificar headers de respuesta",
              "pm.test(\"Headers de respuesta correctos\", function () {",
              "    const contentType = pm.response.headers.get(\"Content-Type\");",
              "    pm.expect(contentType).to.include(\"application/json\");",
              "});",
              "",
              "// 15. Verificar tiempo de respuesta",
              "pm.test(\"Tiempo de respuesta aceptable\", function () {",
              "    pm.expect(pm.response.responseTime).to.be.below(1000);",
              "    console.log(`‚úÖ Tiempo de respuesta: ${pm.response.responseTime}ms`);",
              "});",
              "",
              "// 16. Test de integridad del filtrado",
              "pm.test(\"Integridad del filtrado por is_active\", function () {",
              "    const criticalChecks = [",
              "        { name: \"Status 200\", check: pm.response.code === 200 },",
              "        { name: \"Es array JSON\", check: responseData !== null && Array.isArray(responseData) },",
              "        { name: \"Todos activos\", check: responseData.length === 0 || ",
              "            responseData.every(user => user.is_active === true) }",
              "    ];",
              "    ",
              "    let allPassed = true;",
              "    criticalChecks.forEach(check => {",
              "        console.log(`${check.name}: ${check.check ? '‚úÖ' : '‚ùå'}`);",
              "        if (!check.check) allPassed = false;",
              "    });",
              "    ",
              "    pm.expect(allPassed, \"Fallo una verificaci√≥n cr√≠tica del filtrado\").to.be.true;",
              "    console.log(\"‚úÖ Todas las verificaciones cr√≠ticas pasaron\");",
              "});",
              "",
              "// 17. Guardar informaci√≥n para tests futuros",
              "if (responseData && responseData.length > 0) {",
              "    pm.environment.set(\"active_users_count\", responseData.length.toString());",
              "    ",
              "    // Encontrar y guardar un usuario activo espec√≠fico",
              "    const activeAdmin = responseData.find(user => user.role === \"ADMIN\" && user.is_email_confirmed);",
              "    if (activeAdmin) {",
              "        pm.environment.set(\"active_admin_id\", activeAdmin.id.toString());",
              "        pm.environment.set(\"active_admin_username\", activeAdmin.username);",
              "    }",
              "    ",
              "    const activeUser = responseData.find(user => user.role === \"USER\" && user.is_email_confirmed);",
              "    if (activeUser) {",
              "        pm.environment.set(\"active_user_id\", activeUser.id.toString());",
              "        pm.environment.set(\"active_user_username\", activeUser.username);",
              "    }",
              "}",
              "",
              "// 18. RESUMEN FINAL",
              "console.log(\"\\n\" + \"=\".repeat(60));",
              "console.log(\"‚úÖ FILTRADO POR is_active=true COMPLETADO\");",
              "console.log(\"=\".repeat(60));",
              "console.log(`Resultado: ${responseData ? responseData.length : 0} usuarios activos`);",
              "console.log(`Filtro aplicado correctamente: ‚úÖ`);",
              "console.log(\"=\".repeat(60));",
              "",
              "console.log(\"=== Test de filtrado por is_active completado ===\");"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": ""
        },
        "url": {
          "raw": "{{LOCAL}}/users/?is_active=true",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            ""
          ],
          "query": [
            {
              "key": "is_active",
              "value": "true"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Get_Users_Order_By_Name",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login y obtenci√≥n de tokens ===\");",
              "",
              "// Configuraci√≥n b√°sica",
              "const baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"LOCAL\");",
              "const username = pm.environment.get(\"SUDOUSERNAME\") || pm.globals.get(\"SUDOUSERNAME\");",
              "const password = pm.environment.get(\"SUDOUSERPASS\") || pm.globals.get(\"SUDOUSERPASS\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(\"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\");",
              "}",
              "if (!username || !password) {",
              "    throw new Error(\"Variables SUDOUSERNAME o SUDOUSERPASS no est√°n definidas.\");",
              "}",
              "",
              "const loginUrl = baseUrl.replace(/\\/+$/, \"\") + \"/token/\"; // o \"/api/token/\" seg√∫n tu backend",
              "",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: username,",
              "            password: password",
              "        })",
              "    }",
              "};",
              "",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login:\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login:\", loginData);",
              "        throw new Error(\"La respuesta de login no contiene 'access' y/o 'refresh'.\");",
              "    }",
              "",
              "    // Guardar tokens para otros requests, si los necesitas",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    // Asegurar solo headers, NO tocar el body",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // ‚ö† NO actualizar el body aqu√≠, dejamos el body inv√°lido que seteaste t√∫ a mano",
              "    // pm.request.body.update({ ... });",
              "",
              "    console.log(\"‚úì Login OK. Usando body de refresh tal como est√° configurado en el request (deber√≠a ser inv√°lido).\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": ""
        },
        "url": {
          "raw": "{{LOCAL}}/users/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            ""
          ]
        }
      },
      "response": []
    },
    {
      "name": "Get_Users_Order_By_Role",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login y obtenci√≥n de tokens ===\");",
              "",
              "// Configuraci√≥n b√°sica",
              "const baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"LOCAL\");",
              "const username = pm.environment.get(\"SUDOUSERNAME\") || pm.globals.get(\"SUDOUSERNAME\");",
              "const password = pm.environment.get(\"SUDOUSERPASS\") || pm.globals.get(\"SUDOUSERPASS\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(\"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\");",
              "}",
              "if (!username || !password) {",
              "    throw new Error(\"Variables SUDOUSERNAME o SUDOUSERPASS no est√°n definidas.\");",
              "}",
              "",
              "const loginUrl = baseUrl.replace(/\\/+$/, \"\") + \"/token/\"; // o \"/api/token/\" seg√∫n tu backend",
              "",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: username,",
              "            password: password",
              "        })",
              "    }",
              "};",
              "",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login:\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login:\", loginData);",
              "        throw new Error(\"La respuesta de login no contiene 'access' y/o 'refresh'.\");",
              "    }",
              "",
              "    // Guardar tokens para otros requests, si los necesitas",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    // Asegurar solo headers, NO tocar el body",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // ‚ö† NO actualizar el body aqu√≠, dejamos el body inv√°lido que seteaste t√∫ a mano",
              "    // pm.request.body.update({ ... });",
              "",
              "    console.log(\"‚úì Login OK. Usando body de refresh tal como est√° configurado en el request (deber√≠a ser inv√°lido).\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": ""
        },
        "url": {
          "raw": "{{LOCAL}}/users/?role=ADMIN/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            ""
          ],
          "query": [
            {
              "key": "role",
              "value": "ADMIN/"
            }
          ]
        },
        "description": "TODO: Verificar en aplicacion"
      },
      "response": []
    },
    {
      "name": "Creat_User_User",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login y obtenci√≥n de tokens ===\");",
              "",
              "// Configuraci√≥n b√°sica",
              "const baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"LOCAL\");",
              "const username = pm.environment.get(\"SUDOUSERNAME\") || pm.globals.get(\"SUDOUSERNAME\");",
              "const password = pm.environment.get(\"SUDOUSERPASS\") || pm.globals.get(\"SUDOUSERPASS\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(\"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\");",
              "}",
              "if (!username || !password) {",
              "    throw new Error(\"Variables SUDOUSERNAME o SUDOUSERPASS no est√°n definidas.\");",
              "}",
              "",
              "const loginUrl = baseUrl.replace(/\\/+$/, \"\") + \"/token/\"; // o \"/api/token/\" seg√∫n tu backend",
              "",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: username,",
              "            password: password",
              "        })",
              "    }",
              "};",
              "",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login:\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login:\", loginData);",
              "        throw new Error(\"La respuesta de login no contiene 'access' y/o 'refresh'.\");",
              "    }",
              "",
              "    // Guardar tokens para otros requests, si los necesitas",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    // Asegurar solo headers, NO tocar el body",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // ‚ö† NO actualizar el body aqu√≠, dejamos el body inv√°lido que seteaste t√∫ a mano",
              "    // pm.request.body.update({ ... });",
              "",
              "    console.log(\"‚úì Login OK. Usando body de refresh tal como est√° configurado en el request (deber√≠a ser inv√°lido).\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// ============================================",
              "// TEST: Crear usuario y capturar USER_USER_ID autom√°ticamente",
              "// ============================================",
              "",
              "let responseData;",
              "",
              "pm.test(\"Status code es 201 Created\", function () {",
              "  pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test(\"Respuesta es JSON v√°lido (sin campo id)\", function () {",
              "  responseData = pm.response.json();",
              "  pm.expect(responseData).to.be.an(\"object\");",
              "",
              "  pm.expect(responseData).to.have.property(\"username\");",
              "  pm.expect(responseData).to.have.property(\"email\");",
              "  pm.expect(responseData).to.have.property(\"role\");",
              "  pm.expect(responseData).to.have.property(\"first_name\");",
              "  pm.expect(responseData).to.have.property(\"last_name\");",
              "",
              "  pm.expect(responseData).to.not.have.property(\"id\");",
              "});",
              "",
              "// 1) Guardar username creado",
              "pm.test(\"Guardar CREATED_USERNAME\", function () {",
              "  const username = responseData.username;",
              "  pm.environment.set(\"CREATED_USERNAME\", username);",
              "  pm.collectionVariables.set(\"CREATED_USERNAME\", username);",
              "  console.log(\"‚úÖ CREATED_USERNAME guardado:\", username);",
              "});",
              "",
              "// 2) Buscar el usuario por username y guardar USER_USER_ID",
              "// Ajusta searchUrl si tu backend usa otro path (por ejemplo /api/users/)",
              "(function captureIdAfterCreate() {",
              "  const base = pm.environment.get(\"base_url\") || pm.environment.get(\"LOCAL\") || pm.globals.get(\"LOCAL\");",
              "  if (!base) {",
              "    console.warn(\"‚ö†Ô∏è No hay base_url/LOCAL definido. No se puede buscar el ID.\");",
              "    return;",
              "  }",
              "",
              "  const createdUsername = pm.environment.get(\"CREATED_USERNAME\") || pm.collectionVariables.get(\"CREATED_USERNAME\");",
              "  if (!createdUsername) {",
              "    console.warn(\"‚ö†Ô∏è No se pudo leer CREATED_USERNAME.\");",
              "    return;",
              "  }",
              "",
              "  // Intenta con endpoint con filtro. Cambia a tu ruta real si difiere:",
              "  // Ejemplos:",
              "  //   `${base.replace(/\\/+$/,'')}/users/?username=${encodeURIComponent(createdUsername)}`",
              "  //   `${base.replace(/\\/+$/,'')}/api/users/?username=${encodeURIComponent(createdUsername)}`",
              "  const searchUrl = `${base.replace(/\\/+$/,'')}/users/?username=${encodeURIComponent(createdUsername)}`;",
              "",
              "  pm.sendRequest({",
              "    url: searchUrl,",
              "    method: \"GET\",",
              "    header: {",
              "      \"Accept\": \"application/json\",",
              "      // Si tu API requiere auth, a√±ade el Bearer del login previo:",
              "      ...(pm.environment.get(\"access_token\") ? { \"Authorization\": `Bearer ${pm.environment.get(\"access_token\")}` } : {})",
              "    }",
              "  }, function (err, res) {",
              "    if (err) {",
              "      console.error(\"‚ùå Error buscando usuario por username:\", err);",
              "      return;",
              "    }",
              "",
              "    if (res.code !== 200) {",
              "      console.error(\"‚ùå B√∫squeda de usuario no devolvi√≥ 200. C√≥digo:\", res.code, \"Body:\", res.text());",
              "      return;",
              "    }",
              "",
              "    let list;",
              "    try {",
              "      list = res.json();",
              "    } catch (e) {",
              "      console.error(\"‚ùå Respuesta de b√∫squeda no es JSON:\", res.text());",
              "      return;",
              "    }",
              "",
              "    // Algunas APIs devuelven objeto {results:[...]} en vez de array directo",
              "    if (Array.isArray(list) === false && Array.isArray(list.results)) {",
              "      list = list.results;",
              "    }",
              "",
              "    if (!Array.isArray(list) || list.length === 0) {",
              "      console.error(\"‚ùå No se encontraron usuarios al filtrar por username:\", createdUsername, \"Respuesta:\", list);",
              "      return;",
              "    }",
              "",
              "    const found = list.find(u => u && u.username === createdUsername);",
              "    if (!found) {",
              "      console.error(\"‚ùå No se encontr√≥ el usuario exacto en la lista. Lista:\", list);",
              "      return;",
              "    }",
              "",
              "    if (typeof found.id === \"undefined\" || found.id === null) {",
              "      console.error(\"‚ùå El usuario encontrado no tiene 'id'. Usuario:\", found);",
              "      return;",
              "    }",
              "",
              "    pm.environment.set(\"USER_USER_ID\", found.id);",
              "    pm.collectionVariables.set(\"USER_USER_ID\", found.id);",
              "    console.log(\"‚úÖ USER_USER_ID capturado autom√°ticamente:\", found.id);",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"username\": \"usuario_prueba_123\",\n    \"email\": \"prueba@ejemplo.com\",\n    \"password\": \"Contrase√±aSegura123!\",\n    \"password_confirm\": \"Contrase√±aSegura123!\",\n    \"role\": \"USER\",\n    \"first_name\": \"Juan\",\n    \"last_name\": \"P√©rez\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{LOCAL}}/users/?role=ADMIN/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            ""
          ],
          "query": [
            {
              "key": "role",
              "value": "ADMIN/"
            }
          ]
        },
        "description": "TODO: Verificar en aplicacion"
      },
      "response": []
    },
    {
      "name": "Created_User_Force_Verify",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login y obtenci√≥n de tokens ===\");",
              "",
              "// Configuraci√≥n b√°sica",
              "const baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"LOCAL\");",
              "const username = pm.environment.get(\"SUDOUSERNAME\") || pm.globals.get(\"SUDOUSERNAME\");",
              "const password = pm.environment.get(\"SUDOUSERPASS\") || pm.globals.get(\"SUDOUSERPASS\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(\"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\");",
              "}",
              "if (!username || !password) {",
              "    throw new Error(\"Variables SUDOUSERNAME o SUDOUSERPASS no est√°n definidas.\");",
              "}",
              "",
              "const loginUrl = baseUrl.replace(/\\/+$/, \"\") + \"/token/\"; // o \"/api/token/\" seg√∫n tu backend",
              "",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: username,",
              "            password: password",
              "        })",
              "    }",
              "};",
              "",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login:\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login:\", loginData);",
              "        throw new Error(\"La respuesta de login no contiene 'access' y/o 'refresh'.\");",
              "    }",
              "",
              "    // Guardar tokens para otros requests, si los necesitas",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    // Asegurar solo headers, NO tocar el body",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // ‚ö† NO actualizar el body aqu√≠, dejamos el body inv√°lido que seteaste t√∫ a mano",
              "    // pm.request.body.update({ ... });",
              "",
              "    console.log(\"‚úì Login OK. Usando body de refresh tal como est√° configurado en el request (deber√≠a ser inv√°lido).\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// ============================================",
              "// TEST: Actualizar usuario (confirmar email)",
              "// ============================================",
              "console.log(\"=== Test PATCH /users/{id}/ ===\");",
              "console.log(\"Response status:\", pm.response.code);",
              "console.log(\"Response body:\", pm.response.text());",
              "",
              "pm.test(\"Status code es 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Respuesta es JSON v√°lido\", function () {",
              "    const data = pm.response.json();",
              "    pm.expect(data).to.be.an(\"object\");",
              "});",
              "",
              "pm.test(\"Email confirmado actualizado correctamente\", function () {",
              "    const data = pm.response.json();",
              "    const requestBody = JSON.parse(pm.request.body.raw || \"{}\");",
              "    ",
              "    // Si estamos confirmando email",
              "    if (requestBody.is_email_confirmed !== undefined) {",
              "        pm.expect(data.is_email_confirmed).to.equal(requestBody.is_email_confirmed);",
              "    }",
              "});",
              "",
              "// üî• NUEVO: Guardar USER_USER_ID como variable global",
              "pm.test(\"Guardar USER_USER_ID como variable global\", function () {",
              "    const data = pm.response.json();",
              "    ",
              "    if (data && data.id) {",
              "        // Guardar como variable global",
              "        pm.globals.set(\"USER_USER_ID\", data.id.toString());",
              "        ",
              "        // Tambi√©n como variable de entorno por si acaso",
              "        pm.environment.set(\"USER_USER_ID\", data.id.toString());",
              "        ",
              "        console.log(\"‚úÖ USER_USER_ID guardado como variable global:\", data.id);",
              "        ",
              "        // Verificar que se guard√≥ correctamente",
              "        const savedId = pm.globals.get(\"USER_USER_ID\");",
              "        pm.expect(savedId).to.equal(data.id.toString());",
              "    } else {",
              "        console.warn(\"‚ö†Ô∏è No se encontr√≥ 'id' en la respuesta\");",
              "    }",
              "});",
              "",
              "// Verificar que otros campos no cambiaron",
              "pm.test(\"Otros campos permanecen igual\", function () {",
              "    const data = pm.response.json();",
              "    ",
              "    // Guardar el estado previo si existe",
              "    const previousUser = pm.environment.get(\"user_before_update\");",
              "    if (previousUser) {",
              "        const prev = JSON.parse(previousUser);",
              "        ",
              "        // Verificar que campos no modificados siguen igual",
              "        if (prev.username && data.username) {",
              "            pm.expect(data.username).to.equal(prev.username);",
              "        }",
              "        if (prev.email && data.email) {",
              "            pm.expect(data.email).to.equal(prev.email);",
              "        }",
              "        if (prev.role && data.role) {",
              "            pm.expect(data.role).to.equal(prev.role);",
              "        }",
              "    }",
              "});",
              "",
              "// üî• OPCI√ìN ALTERNATIVA: Tambi√©n guardar otros datos √∫tiles",
              "pm.test(\"Guardar datos completos del usuario actualizado\", function () {",
              "    const data = pm.response.json();",
              "    ",
              "    if (data && data.id) {",
              "        // Guardar objeto completo para referencia futura",
              "        pm.globals.set(\"USER_CURRENT_DATA\", JSON.stringify(data));",
              "        ",
              "        // Guardar campos individuales √∫tiles",
              "        if (data.username) {",
              "            pm.globals.set(\"USER_USERNAME\", data.username);",
              "        }",
              "        if (data.email) {",
              "            pm.globals.set(\"USER_EMAIL\", data.email);",
              "        }",
              "        if (data.role) {",
              "            pm.globals.set(\"USER_ROLE\", data.role);",
              "        }",
              "        ",
              "        console.log(\"‚úÖ Datos del usuario guardados en variables globales\");",
              "    }",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "PUT",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"is_email_confirmed\" : true\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{LOCAL}}/users/{{USER_USER_ID}}/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            "{{USER_USER_ID}}",
            ""
          ]
        },
        "description": "TODO: Verificar en aplicacion"
      },
      "response": []
    },
    {
      "name": "Creat_User_Must_Fail",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login y obtenci√≥n de tokens ===\");",
              "",
              "// Configuraci√≥n b√°sica",
              "const baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"LOCAL\");",
              "const username = pm.environment.get(\"SUDOUSERNAME\") || pm.globals.get(\"SUDOUSERNAME\");",
              "const password = pm.environment.get(\"SUDOUSERPASS\") || pm.globals.get(\"SUDOUSERPASS\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(\"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\");",
              "}",
              "if (!username || !password) {",
              "    throw new Error(\"Variables SUDOUSERNAME o SUDOUSERPASS no est√°n definidas.\");",
              "}",
              "",
              "const loginUrl = baseUrl.replace(/\\/+$/, \"\") + \"/token/\"; // o \"/api/token/\" seg√∫n tu backend",
              "",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: username,",
              "            password: password",
              "        })",
              "    }",
              "};",
              "",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login:\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login:\", loginData);",
              "        throw new Error(\"La respuesta de login no contiene 'access' y/o 'refresh'.\");",
              "    }",
              "",
              "    // Guardar tokens para otros requests, si los necesitas",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    // Asegurar solo headers, NO tocar el body",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // ‚ö† NO actualizar el body aqu√≠, dejamos el body inv√°lido que seteaste t√∫ a mano",
              "    // pm.request.body.update({ ... });",
              "",
              "    console.log(\"‚úì Login OK. Usando body de refresh tal como est√° configurado en el request (deber√≠a ser inv√°lido).\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// ============================================",
              "// TEST: Error al crear usuario duplicado",
              "// Endpoint: POST /api/users/",
              "// Escenario: Username y email ya existen",
              "// ============================================",
              "",
              "console.log(\"=== Test: Error - Usuario duplicado ===\");",
              "",
              "// 1. Verificar que falla con status 400 Bad Request",
              "pm.test(\"Status code es 400 Bad Request\", function () {",
              "    pm.response.to.have.status(400);",
              "});",
              "",
              "// 2. Parsear respuesta JSON del error",
              "let responseData = null;",
              "try {",
              "    responseData = pm.response.json();",
              "    pm.test(\"Error response es JSON v√°lido\", function () {",
              "        pm.expect(responseData).to.be.an(\"object\");",
              "    });",
              "} catch (e) {",
              "    pm.test(\"Error response es JSON v√°lido\", function () {",
              "        pm.expect.fail(\"La respuesta no es JSON v√°lido: \" + e.message);",
              "    });",
              "}",
              "",
              "// 3. DEBUG: Mostrar qu√© se intent√≥ crear",
              "const requestBody = JSON.parse(pm.request.body.raw || \"{}\");",
              "console.log(`DEBUG - Intento de crear usuario:`);",
              "console.log(`  username: \"${requestBody.username}\"`);",
              "console.log(`  email: \"${requestBody.email}\"`);",
              "console.log(`  role: ${requestBody.role}`);",
              "console.log(`  Problema: Username y email ya existen`);",
              "",
              "// 4. Verificar estructura espec√≠fica del error de duplicado",
              "if (responseData) {",
              "    console.log(\"Estructura del error:\", JSON.stringify(responseData, null, 2));",
              "    ",
              "    // 5. Verificar que tiene errores en username y email",
              "    pm.test(\"Tiene error en campo username\", function () {",
              "        pm.expect(responseData).to.have.property(\"username\");",
              "        pm.expect(responseData.username).to.be.an(\"array\");",
              "        pm.expect(responseData.username.length).to.be.greaterThan(0);",
              "    });",
              "    ",
              "    pm.test(\"Tiene error en campo email\", function () {",
              "        pm.expect(responseData).to.have.property(\"email\");",
              "        pm.expect(responseData.email).to.be.an(\"array\");",
              "        pm.expect(responseData.email.length).to.be.greaterThan(0);",
              "    });",
              "    ",
              "    // 6. Verificar mensajes de error espec√≠ficos",
              "    const usernameError = responseData.username[0];",
              "    const emailError = responseData.email[0];",
              "    ",
              "    pm.test(\"Mensaje de error en username es el esperado\", function () {",
              "        pm.expect(usernameError).to.equal(\"A user with that username already exists.\");",
              "        console.log(`‚úÖ Error username: \"${usernameError}\"`);",
              "    });",
              "    ",
              "    pm.test(\"Mensaje de error en email es el esperado\", function () {",
              "        pm.expect(emailError).to.equal(\"user with this email already exists.\");",
              "        console.log(`‚úÖ Error email: \"${emailError}\"`);",
              "    });",
              "    ",
              "    // 7. Verificar que los errores mencionan \"already exists\"",
              "    pm.test(\"Errores indican que ya existen\", function () {",
              "        pm.expect(usernameError.toLowerCase()).to.include(\"already exists\");",
              "        pm.expect(emailError.toLowerCase()).to.include(\"already exists\");",
              "    });",
              "    ",
              "    // 8. Verificar que NO tiene otros errores (solo duplicados)",
              "    pm.test(\"Solo tiene errores de duplicado\", function () {",
              "        const errorKeys = Object.keys(responseData);",
              "        console.log(`Campos con error: ${errorKeys.join(\", \")}`);",
              "        ",
              "        // Deber√≠a tener solo username y email (o quiz√°s otros si hay m√°s errores)",
              "        pm.expect(errorKeys).to.include.members([\"username\", \"email\"]);",
              "        ",
              "        // Verificar que no hay errores en password u otros campos",
              "        if (errorKeys.length > 2) {",
              "            const otherErrors = errorKeys.filter(key => ![\"username\", \"email\"].includes(key));",
              "            console.log(`‚ö† Otros errores: ${otherErrors.join(\", \")}`);",
              "        }",
              "    });",
              "    ",
              "    // 9. Verificar que NO es una respuesta exitosa",
              "    pm.test(\"No es una creaci√≥n exitosa\", function () {",
              "        pm.expect(responseData).to.not.have.property(\"id\");",
              "        pm.expect(responseData).to.not.have.property(\"created_user\");",
              "        pm.expect(responseData).to.not.have.property(\"success\");",
              "    });",
              "}",
              "",
              "// 10. Verificar headers de respuesta",
              "pm.test(\"Headers de respuesta correctos para error\", function () {",
              "    const contentType = pm.response.headers.get(\"Content-Type\");",
              "    pm.expect(contentType).to.include(\"application/json\");",
              "    console.log(`‚úÖ Content-Type: ${contentType}`);",
              "});",
              "",
              "// 11. Verificar tiempo de respuesta (debe ser r√°pido para error de validaci√≥n)",
              "pm.test(\"Tiempo de respuesta r√°pido\", function () {",
              "    pm.expect(pm.response.responseTime).to.be.below(200);",
              "    console.log(`‚úÖ Tiempo de respuesta: ${pm.response.responseTime}ms`);",
              "});",
              "",
              "// 12. Test de integridad del error",
              "pm.test(\"Integridad del error de duplicado\", function () {",
              "    const criticalChecks = [",
              "        { name: \"Status 400\", check: pm.response.code === 400 },",
              "        { name: \"Es JSON\", check: responseData !== null },",
              "        { name: \"Error en username\", check: responseData && responseData.username },",
              "        { name: \"Error en email\", check: responseData && responseData.email },",
              "        { name: \"Mensajes espec√≠ficos\", check: responseData && ",
              "            responseData.username && responseData.username[0] === \"A user with that username already exists.\" &&",
              "            responseData.email && responseData.email[0] === \"user with this email already exists.\" }",
              "    ];",
              "    ",
              "    let allPassed = true;",
              "    criticalChecks.forEach(check => {",
              "        console.log(`${check.name}: ${check.check ? '‚úÖ' : '‚ùå'}`);",
              "        if (!check.check) allPassed = false;",
              "    });",
              "    ",
              "    pm.expect(allPassed, \"Fallo una verificaci√≥n cr√≠tica del error de duplicado\").to.be.true;",
              "    console.log(\"‚úÖ Todas las verificaciones cr√≠ticas pasaron\");",
              "});",
              "",
              "// 13. RESUMEN FINAL",
              "console.log(\"\\n\" + \"=\".repeat(60));",
              "console.log(\"‚úÖ VALIDACI√ìN DE UNICIDAD CONFIRMADA\");",
              "console.log(\"=\".repeat(60));",
              "console.log(\"La API correctamente previene duplicados:\");",
              "console.log(\"1. ‚ùå Username 'usuario_prueba_123' ya existe\");",
              "console.log(\"2. ‚ùå Email 'prueba@ejemplo.com' ya existe\");",
              "console.log(\"3. ‚úÖ Retorn√≥ status 400 Bad Request\");",
              "console.log(\"4. ‚úÖ Mensajes de error claros y espec√≠ficos\");",
              "console.log(\"5. ‚úÖ Valid√≥ ambos campos (username y email)\");",
              "console.log(\"=\".repeat(60));",
              "",
              "// 14. SOLUCIONES SUGERIDAS",
              "console.log(\"\\nüí° SOLUCIONES PARA EVITAR ESTE ERROR:\");",
              "console.log(\"1. Usar datos √∫nicos en cada prueba:\");",
              "console.log(\"   username: usuario_prueba_\" + new Date().getTime());",
              "console.log(\"   email: prueba_\" + new Date().getTime() + \"@ejemplo.com\");",
              "console.log(\"\");",
              "console.log(\"2. Eliminar el usuario existente antes de crear:\");",
              "console.log(\"   DELETE {{base_url}}/api/users/<id_existente>/\");",
              "console.log(\"\");",
              "console.log(\"3. Verificar si el usuario ya existe antes de crear\");",
              "",
              "// 15. Guardar informaci√≥n del error para referencia",
              "if (responseData && responseData.username && responseData.email) {",
              "    pm.environment.set(\"last_duplicate_user_error\", JSON.stringify({",
              "        timestamp: new Date().toISOString(),",
              "        attempted_username: requestBody.username,",
              "        attempted_email: requestBody.email,",
              "        username_error: responseData.username[0],",
              "        email_error: responseData.email[0],",
              "        status_code: 400,",
              "        response_time: pm.response.responseTime,",
              "        note: \"Validaci√≥n de unicidad funcionando correctamente\"",
              "    }));",
              "}",
              "",
              "console.log(\"=== Test de error por usuario duplicado completado ===\");"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"username\": \"usuario_prueba_123\",\n    \"email\": \"prueba@ejemplo.com\",\n    \"password\": \"Contrase√±aSegura123!\",\n    \"password_confirm\": \"Contrase√±aSegura123!\",\n    \"role\": \"USER\",\n    \"first_name\": \"Juan\",\n    \"last_name\": \"P√©rez\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{LOCAL}}/users/?role=ADMIN/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            ""
          ],
          "query": [
            {
              "key": "role",
              "value": "ADMIN/"
            }
          ]
        },
        "description": "TODO: Verificar en aplicacion"
      },
      "response": []
    },
    {
      "name": "User_User_Fails_Try_To_Create_User",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login con usuario_prueba_123 y obtenci√≥n de tokens ===\");",
              "",
              "// 1. Configuraci√≥n b√°sica de URL",
              "const baseUrl =",
              "    pm.environment.get(\"base_url\") ||",
              "    pm.environment.get(\"LOCAL\") ||",
              "    pm.globals.get(\"LOCAL\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(",
              "        \"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\"",
              "    );",
              "}",
              "",
              "// Aseguramos que no termine en \"/\"",
              "const normalizedBaseUrl = baseUrl.replace(/\\/+$/, \"\");",
              "",
              "// Ajusta esta ruta si tu backend usa otra (por ejemplo: '/api/token/')",
              "const loginUrl = normalizedBaseUrl + \"/token/\";",
              "",
              "// 2. Credenciales FIJAS del usuario que indicaste",
              "const loginUsername = \"usuario_prueba_123\";",
              "const loginPassword = \"Contrase√±aSegura123!\";",
              "",
              "console.log(\"‚Üí Haciendo login en:\", loginUrl);",
              "console.log(\"‚Üí Usuario de login:\", loginUsername);",
              "",
              "// 3. Construir request de login",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: loginUsername,",
              "            password: loginPassword",
              "        })",
              "    }",
              "};",
              "",
              "// 4. Ejecutar login y guardar tokens",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    console.log(\"C√≥digo de respuesta de login:\", response.code);",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login (error):\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login sin campos esperados:\", loginData);",
              "        throw new Error(",
              "            \"La respuesta de login no contiene 'access' y/o 'refresh'. Revisa el endpoint de login.\"",
              "        );",
              "    }",
              "",
              "    // 5. Guardar tokens en variables de entorno",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    console.log(\"‚úì Login OK. Tokens guardados en variables de entorno:\");",
              "    console.log(\"  - access_token\");",
              "    console.log(\"  - refresh_token\");",
              "    console.log(\"  - temp_access_token\");",
              "    console.log(\"  - temp_refresh_token\");",
              "",
              "    // 6. Solo tocamos headers, NO el body del request original",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // Si este request tiene Auth tipo Bearer con variable {{access_token}},",
              "    // ya quedar√° usando el token reci√©n obtenido.",
              "    console.log(",
              "        \"‚úì Headers configurados. El body del request se mantiene tal como lo definiste.\"",
              "    );",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// ============================================",
              "// TEST: Usuario USER intenta crear usuario - Error 403",
              "// Escenario: Usuario regular (role=USER) intenta crear otro usuario",
              "// Debe fallar con 403 Forbidden",
              "// ============================================",
              "",
              "console.log(\"=== Test: USER intenta crear usuario - Sin permisos ===\");",
              "",
              "// 1. Verificar que falla con status 403 Forbidden",
              "pm.test(\"Status code es 403 Forbidden\", function () {",
              "    pm.response.to.have.status(403);",
              "});",
              "",
              "// 2. Parsear respuesta JSON del error",
              "let responseData = null;",
              "try {",
              "    responseData = pm.response.json();",
              "    pm.test(\"Error response es JSON v√°lido\", function () {",
              "        pm.expect(responseData).to.be.an(\"object\");",
              "    });",
              "} catch (e) {",
              "    pm.test(\"Error response es JSON v√°lido\", function () {",
              "        pm.expect.fail(\"La respuesta no es JSON v√°lido: \" + e.message);",
              "    });",
              "}",
              "",
              "// 3. DEBUG: Mostrar contexto del error",
              "const requestBody = JSON.parse(pm.request.body.raw || \"{}\");",
              "const currentUser = pm.environment.get(\"created_user_username\") || \"Usuario USER\";",
              "const currentUserRole = pm.environment.get(\"created_user_role\") || \"USER\";",
              "",
              "console.log(`DEBUG - Contexto del error:`);",
              "console.log(`  Usuario autenticado: ${currentUser} (${currentUserRole})`);",
              "console.log(`  Intentando crear: ${requestBody.username}`);",
              "console.log(`  Role a crear: ${requestBody.role}`);",
              "console.log(`  Problema: Usuario USER no tiene permisos para crear usuarios`);",
              "",
              "// 4. Verificar estructura del error 403",
              "if (responseData) {",
              "    console.log(\"Estructura del error 403:\", JSON.stringify(responseData, null, 2));",
              "    ",
              "    // 5. Verificar que tiene propiedad \"detail\" (com√∫n en DRF)",
              "    pm.test(\"Error tiene mensaje de detalle\", function () {",
              "        pm.expect(responseData).to.have.property(\"detail\");",
              "        pm.expect(responseData.detail).to.be.a(\"string\");",
              "    });",
              "    ",
              "    // 6. Verificar mensaje de error espec√≠fico",
              "    const errorDetail = responseData.detail;",
              "    pm.test(\"Mensaje de error indica falta de permisos\", function () {",
              "        // Posibles mensajes de error",
              "        const permissionMessages = [",
              "            \"You do not have permission to perform this action.\",",
              "            \"Permission denied.\",",
              "            \"Access denied.\",",
              "            \"Forbidden.\",",
              "            \"No tiene permisos para realizar esta acci√≥n.\"",
              "        ];",
              "        ",
              "        const hasPermissionError = permissionMessages.some(msg => ",
              "            errorDetail.includes(msg) || msg.includes(errorDetail)",
              "        );",
              "        ",
              "        pm.expect(hasPermissionError, `Mensaje inesperado: \"${errorDetail}\"`).to.be.true;",
              "        console.log(`‚úÖ Error de permisos: \"${errorDetail}\"`);",
              "    });",
              "    ",
              "    // 7. Verificar que NO es error de validaci√≥n 400",
              "    pm.test(\"No es error de validaci√≥n 400\", function () {",
              "        pm.expect(responseData).to.not.have.property(\"username\");",
              "        pm.expect(responseData).to.not.have.property(\"email\");",
              "        pm.expect(responseData).to.not.have.property(\"password\");",
              "    });",
              "    ",
              "    // 8. Verificar estructura minimalista",
              "    pm.test(\"Estructura de error 403 simple\", function () {",
              "        const keys = Object.keys(responseData);",
              "        console.log(`Campos en error response: ${keys.join(\", \")}`);",
              "        pm.expect(keys.length).to.be.at.least(1);",
              "        pm.expect(keys).to.include(\"detail\");",
              "    });",
              "}",
              "",
              "// 9. Verificar headers de respuesta",
              "pm.test(\"Headers de respuesta correctos para error 403\", function () {",
              "    const contentType = pm.response.headers.get(\"Content-Type\");",
              "    pm.expect(contentType).to.include(\"application/json\");",
              "    console.log(`‚úÖ Content-Type: ${contentType}`);",
              "});",
              "",
              "// 10. Verificar tiempo de respuesta",
              "pm.test(\"Tiempo de respuesta r√°pido\", function () {",
              "    pm.expect(pm.response.responseTime).to.be.below(200);",
              "    console.log(`‚úÖ Tiempo de respuesta: ${pm.response.responseTime}ms`);",
              "});",
              "",
              "// 11. Test de integridad del error de permisos",
              "pm.test(\"Integridad del error 403 por permisos\", function () {",
              "    const criticalChecks = [",
              "        { name: \"Status 403\", check: pm.response.code === 403 },",
              "        { name: \"Es JSON\", check: responseData !== null },",
              "        { name: \"Tiene mensaje detail\", check: responseData && responseData.detail },",
              "        { name: \"Es error de permisos\", check: responseData && ",
              "            (responseData.detail.includes(\"permission\") || ",
              "             responseData.detail.includes(\"Permission\") ||",
              "             responseData.detail.includes(\"Forbidden\")) }",
              "    ];",
              "    ",
              "    let allPassed = true;",
              "    criticalChecks.forEach(check => {",
              "        console.log(`${check.name}: ${check.check ? '‚úÖ' : '‚ùå'}`);",
              "        if (!check.check) allPassed = false;",
              "    });",
              "    ",
              "    pm.expect(allPassed, \"Fallo una verificaci√≥n cr√≠tica del error de permisos\").to.be.true;",
              "    console.log(\"‚úÖ Todas las verificaciones cr√≠ticas pasaron\");",
              "});",
              "",
              "// 12. RESUMEN FINAL - CONFIRMACI√ìN DE SEGURIDAD",
              "console.log(\"\\n\" + \"=\".repeat(60));",
              "console.log(\"‚úÖ SISTEMA DE PERMISOS CONFIRMADO\");",
              "console.log(\"=\".repeat(60));",
              "console.log(\"La API correctamente implementa control de permisos:\");",
              "console.log(\"1. üîí Usuario autenticado: \" + currentUser);",
              "console.log(\"2. üé≠ Role del usuario: \" + currentUserRole);",
              "console.log(\"3. ‚ùå Acci√≥n intentada: Crear nuevo usuario\");",
              "console.log(\"4. ‚úÖ Resultado: 403 Forbidden (Sin permisos)\");",
              "console.log(\"5. üìã Regla validada: Solo ADMIN/SUDO pueden crear usuarios\");",
              "console.log(\"=\".repeat(60));",
              "",
              "// 13. INFORMACI√ìN ADICIONAL SOBRE PERMISOS",
              "console.log(\"\\nüìã MATRIZ DE PERMISOS PARA CREAR USUARIOS:\");",
              "console.log(\"   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\");",
              "console.log(\"   ‚îÇ   Role   ‚îÇ Puede crear  ‚îÇ\");",
              "console.log(\"   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\");",
              "console.log(\"   ‚îÇ   USER   ‚îÇ     NO ‚ùå     ‚îÇ\");",
              "console.log(\"   ‚îÇ   ADMIN  ‚îÇ     SI ‚úÖ     ‚îÇ\");",
              "console.log(\"   ‚îÇ   SUDO   ‚îÇ     SI ‚úÖ     ‚îÇ\");",
              "console.log(\"   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\");",
              "",
              "console.log(\"\\nüí° NOTA: Para crear usuarios necesitas:\");",
              "console.log(\"   1. Autenticarte como ADMIN o SUDO\");",
              "console.log(\"   2. Usar token v√°lido en header Authorization\");",
              "console.log(\"   3. Para crear SUDO, necesitas ser SUDO\");",
              "",
              "// 14. Guardar informaci√≥n del error para referencia",
              "if (responseData && responseData.detail) {",
              "    pm.environment.set(\"last_permission_error\", JSON.stringify({",
              "        timestamp: new Date().toISOString(),",
              "        endpoint: \"/api/users/\",",
              "        authenticated_user: currentUser,",
              "        user_role: currentUserRole,",
              "        error_message: responseData.detail,",
              "        status_code: 403,",
              "        response_time: pm.response.responseTime,",
              "        note: \"Usuario USER correctamente bloqueado de crear usuarios\"",
              "    }));",
              "}",
              "",
              "console.log(\"=== Test de error por falta de permisos completado ===\");",
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"username\": \"usuario_prueba_123\",\n    \"email\": \"prueba@ejemplo.com\",\n    \"password\": \"Contrase√±aSegura123!\",\n    \"password_confirm\": \"Contrase√±aSegura123!\",\n    \"role\": \"USER\",\n    \"first_name\": \"Juan\",\n    \"last_name\": \"P√©rez\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{LOCAL}}/users/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            ""
          ]
        },
        "description": "TODO: Verificar en aplicacion"
      },
      "response": []
    },
    {
      "name": "User_User_Get_Is_Info",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login con usuario_prueba_123 y obtenci√≥n de tokens ===\");",
              "",
              "// 1. Configuraci√≥n b√°sica de URL",
              "const baseUrl =",
              "    pm.environment.get(\"base_url\") ||",
              "    pm.environment.get(\"LOCAL\") ||",
              "    pm.globals.get(\"LOCAL\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(",
              "        \"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\"",
              "    );",
              "}",
              "",
              "// Aseguramos que no termine en \"/\"",
              "const normalizedBaseUrl = baseUrl.replace(/\\/+$/, \"\");",
              "",
              "// Ajusta esta ruta si tu backend usa otra (por ejemplo: '/api/token/')",
              "const loginUrl = normalizedBaseUrl + \"/token/\";",
              "",
              "// 2. Credenciales FIJAS del usuario que indicaste",
              "const loginUsername = \"usuario_prueba_123\";",
              "const loginPassword = \"Contrase√±aSegura123!\";",
              "",
              "console.log(\"‚Üí Haciendo login en:\", loginUrl);",
              "console.log(\"‚Üí Usuario de login:\", loginUsername);",
              "",
              "// 3. Construir request de login",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: loginUsername,",
              "            password: loginPassword",
              "        })",
              "    }",
              "};",
              "",
              "// 4. Ejecutar login y guardar tokens",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    console.log(\"C√≥digo de respuesta de login:\", response.code);",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login (error):\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login sin campos esperados:\", loginData);",
              "        throw new Error(",
              "            \"La respuesta de login no contiene 'access' y/o 'refresh'. Revisa el endpoint de login.\"",
              "        );",
              "    }",
              "",
              "    // 5. Guardar tokens en variables de entorno",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    console.log(\"‚úì Login OK. Tokens guardados en variables de entorno:\");",
              "    console.log(\"  - access_token\");",
              "    console.log(\"  - refresh_token\");",
              "    console.log(\"  - temp_access_token\");",
              "    console.log(\"  - temp_refresh_token\");",
              "",
              "    // 6. Solo tocamos headers, NO el body del request original",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // Si este request tiene Auth tipo Bearer con variable {{access_token}},",
              "    // ya quedar√° usando el token reci√©n obtenido.",
              "    console.log(",
              "        \"‚úì Headers configurados. El body del request se mantiene tal como lo definiste.\"",
              "    );",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// ============================================",
              "// TEST: Perfil del usuario autenticado (/api/users/me/)",
              "// Usuario: usuario_prueba_123",
              "// ============================================",
              "",
              "console.log(\"=== Test: GET /api/users/me/ para usuario_prueba_123 ===\");",
              "",
              "// 1. Status 200 OK",
              "pm.test(\"Status code es 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "// 2. Respuesta es JSON v√°lido",
              "let data;",
              "pm.test(\"Respuesta es JSON v√°lido\", function () {",
              "    data = pm.response.json();",
              "    pm.expect(data).to.be.an(\"object\");",
              "});",
              "",
              "// 3. Estructura b√°sica del perfil",
              "pm.test(\"Respuesta tiene campos b√°sicos del perfil\", function () {",
              "    pm.expect(data).to.have.property(\"id\");",
              "    pm.expect(data).to.have.property(\"username\");",
              "    pm.expect(data).to.have.property(\"email\");",
              "    pm.expect(data).to.have.property(\"first_name\");",
              "    pm.expect(data).to.have.property(\"last_name\");",
              "    pm.expect(data).to.have.property(\"role\");",
              "    pm.expect(data).to.have.property(\"is_email_confirmed\");",
              "    pm.expect(data).to.have.property(\"is_active\");",
              "    pm.expect(data).to.have.property(\"is_staff\");",
              "    pm.expect(data).to.have.property(\"is_superuser\");",
              "    pm.expect(data).to.have.property(\"date_joined\");",
              "    pm.expect(data).to.have.property(\"last_login\");",
              "});",
              "",
              "// 4. Tipos de datos",
              "// 4. Tipos de datos",
              "pm.test(\"Tipos de datos en el perfil son correctos\", function () {",
              "    pm.expect(data.id).to.be.a(\"number\");",
              "    pm.expect(data.username).to.be.a(\"string\");",
              "    pm.expect(data.email).to.be.a(\"string\");",
              "    pm.expect(data.first_name).to.be.a(\"string\");",
              "    pm.expect(data.last_name).to.be.a(\"string\");",
              "    pm.expect(data.role).to.be.a(\"string\");",
              "    pm.expect(data.is_email_confirmed).to.be.a(\"boolean\");",
              "    pm.expect(data.is_active).to.be.a(\"boolean\");",
              "    pm.expect(data.is_staff).to.be.a(\"boolean\");",
              "    pm.expect(data.is_superuser).to.be.a(\"boolean\");",
              "    pm.expect(data.date_joined).to.be.a(\"string\");",
              "",
              "    // last_login puede ser string o null (si nunca ha iniciado sesi√≥n)",
              "    pm.expect(",
              "        data.last_login === null || typeof data.last_login === \"string\",",
              "        \"last_login debe ser null o string\"",
              "    ).to.be.true;",
              "",
              "    // Campo extra que tu API devuelve",
              "    pm.expect(data.nodes_created_count).to.be.a(\"number\");",
              "});",
              "",
              "// 5. Validar que corresponde al usuario esperado",
              "pm.test(\"El perfil corresponde a usuario_prueba_123\", function () {",
              "    pm.expect(data.username).to.eql(\"usuario_prueba_123\");",
              "    pm.expect(data.email).to.eql(\"prueba@ejemplo.com\");",
              "",
              "    // Nombres si tu backend los guarda tal cual",
              "    pm.expect(data.first_name).to.eql(\"Juan\");",
              "    pm.expect(data.last_name).to.eql(\"P√©rez\");",
              "",
              "    // Rol esperado para este user",
              "    pm.expect(data.role).to.eql(\"USER\");",
              "});",
              "",
              "// 6. Flags de estado coherentes para un usuario normal",
              "pm.test(\"Flags de estado del usuario son coherentes\", function () {",
              "    // Ajusta estos seg√∫n como crees el user",
              "    pm.expect(data.is_active).to.eql(true);",
              "",
              "    // Para un USER normal normalmente:",
              "    pm.expect(data.is_staff).to.eql(false);",
              "    pm.expect(data.is_superuser).to.eql(false);",
              "});",
              "",
              "// 7. Guardar el id del usuario para otros tests",
              "pm.test(\"Guardar ID de usuario en variables\", function () {",
              "    if (typeof data.id !== \"undefined\") {",
              "        pm.environment.set(\"USER_USER_ID\", data.id);",
              "        pm.collectionVariables.set(\"USER_USER_ID\", data.id);",
              "        console.log(\"USER_USER_ID guardado:\", data.id);",
              "    } else {",
              "        pm.expect.fail(\"No se encontr√≥ 'id' en la respuesta de /me/\");",
              "    }",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"username\": \"usuario_prueba_123\",\n    \"email\": \"prueba@ejemplo.com\",\n    \"password\": \"Contrase√±aSegura123!\",\n    \"password_confirm\": \"Contrase√±aSegura123!\",\n    \"role\": \"USER\",\n    \"first_name\": \"Juan\",\n    \"last_name\": \"P√©rez\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{LOCAL}}/users/me/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            "me",
            ""
          ]
        },
        "description": "TODO: Verificar en aplicacion"
      },
      "response": []
    },
    {
      "name": "User_User_Update_is_info",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login con usuario_prueba_123 y obtenci√≥n de tokens ===\");",
              "",
              "// 1. Configuraci√≥n b√°sica de URL",
              "const baseUrl =",
              "    pm.environment.get(\"base_url\") ||",
              "    pm.environment.get(\"LOCAL\") ||",
              "    pm.globals.get(\"LOCAL\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(",
              "        \"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\"",
              "    );",
              "}",
              "",
              "// Aseguramos que no termine en \"/\"",
              "const normalizedBaseUrl = baseUrl.replace(/\\/+$/, \"\");",
              "",
              "// Ajusta esta ruta si tu backend usa otra (por ejemplo: '/api/token/')",
              "const loginUrl = normalizedBaseUrl + \"/token/\";",
              "",
              "// 2. Credenciales FIJAS del usuario que indicaste",
              "const loginUsername = \"usuario_prueba_123\";",
              "const loginPassword = \"Contrase√±aSegura123!\";",
              "",
              "console.log(\"‚Üí Haciendo login en:\", loginUrl);",
              "console.log(\"‚Üí Usuario de login:\", loginUsername);",
              "",
              "// 3. Construir request de login",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: loginUsername,",
              "            password: loginPassword",
              "        })",
              "    }",
              "};",
              "",
              "// 4. Ejecutar login y guardar tokens",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    console.log(\"C√≥digo de respuesta de login:\", response.code);",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login (error):\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login sin campos esperados:\", loginData);",
              "        throw new Error(",
              "            \"La respuesta de login no contiene 'access' y/o 'refresh'. Revisa el endpoint de login.\"",
              "        );",
              "    }",
              "",
              "    // 5. Guardar tokens en variables de entorno",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    console.log(\"‚úì Login OK. Tokens guardados en variables de entorno:\");",
              "    console.log(\"  - access_token\");",
              "    console.log(\"  - refresh_token\");",
              "    console.log(\"  - temp_access_token\");",
              "    console.log(\"  - temp_refresh_token\");",
              "",
              "    // 6. Solo tocamos headers, NO el body del request original",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // Si este request tiene Auth tipo Bearer con variable {{access_token}},",
              "    // ya quedar√° usando el token reci√©n obtenido.",
              "    console.log(",
              "        \"‚úì Headers configurados. El body del request se mantiene tal como lo definiste.\"",
              "    );",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// ============================================",
              "// TEST: Actualizar perfil del usuario autenticado (/api/users/me/update/)",
              "// Usuario: usuario_prueba_123",
              "// ============================================",
              "",
              "console.log(\"=== Test: PUT /api/users/me/update/ para usuario_prueba_123 ===\");",
              "",
              "// 1. Status 200 OK",
              "pm.test(\"Status code es 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "// 2. Respuesta es JSON v√°lido",
              "let data;",
              "pm.test(\"Respuesta es JSON v√°lido\", function () {",
              "    data = pm.response.json();",
              "    pm.expect(data).to.be.an(\"object\");",
              "});",
              "",
              "// 3. Estructura b√°sica del perfil actualizado",
              "pm.test(\"Respuesta tiene campos b√°sicos del perfil actualizado\", function () {",
              "    pm.expect(data).to.have.property(\"id\");",
              "    pm.expect(data).to.have.property(\"username\");",
              "    pm.expect(data).to.have.property(\"email\");",
              "    pm.expect(data).to.have.property(\"first_name\");",
              "    pm.expect(data).to.have.property(\"last_name\");",
              "    pm.expect(data).to.have.property(\"role\");",
              "    pm.expect(data).to.have.property(\"is_email_confirmed\");",
              "    pm.expect(data).to.have.property(\"is_active\");",
              "    pm.expect(data).to.have.property(\"is_staff\");",
              "    pm.expect(data).to.have.property(\"is_superuser\");",
              "    pm.expect(data).to.have.property(\"date_joined\");",
              "    pm.expect(data).to.have.property(\"last_login\");",
              "});",
              "",
              "// 4. Tipos de datos",
              "pm.test(\"Tipos de datos en el perfil actualizado son correctos\", function () {",
              "    pm.expect(data.id).to.be.a(\"number\");",
              "    pm.expect(data.username).to.be.a(\"string\");",
              "    pm.expect(data.email).to.be.a(\"string\");",
              "    pm.expect(data.first_name).to.be.a(\"string\");",
              "    pm.expect(data.last_name).to.be.a(\"string\");",
              "    pm.expect(data.role).to.be.a(\"string\");",
              "    pm.expect(data.is_email_confirmed).to.be.a(\"boolean\");",
              "    pm.expect(data.is_active).to.be.a(\"boolean\");",
              "    pm.expect(data.is_staff).to.be.a(\"boolean\");",
              "    pm.expect(data.is_superuser).to.be.a(\"boolean\");",
              "    pm.expect(data.date_joined).to.be.a(\"string\");",
              "",
              "    // last_login puede ser string o null",
              "    pm.expect(",
              "        data.last_login === null || typeof data.last_login === \"string\",",
              "        \"last_login debe ser null o string\"",
              "    ).to.be.true;",
              "});",
              "",
              "// 5. Validar que los campos cambiados tienen los nuevos valores",
              "pm.test(\"Los datos del usuario se actualizaron correctamente (sin tocar password ni rol)\", function () {",
              "    // Estos valores deben coincidir con el body del request que est√°s enviando",
              "    pm.expect(data.username).to.eql(\"usuario_prueba_123_actualizado\");",
              "    pm.expect(data.email).to.eql(\"prueba.actualizada@ejemplo.com\");",
              "    pm.expect(data.first_name).to.eql(\"Juanito\");",
              "    pm.expect(data.last_name).to.eql(\"P√©rez G√≥mez\");",
              "",
              "    // No cambiamos el rol: sigue siendo USER",
              "    pm.expect(data.role).to.eql(\"USER\");",
              "",
              "    // Flags coherentes",
              "    pm.expect(data.is_active).to.eql(true);",
              "    pm.expect(data.is_email_confirmed).to.eql(true);",
              "});",
              "",
              "// 6. Guardar de nuevo el ID y el username actualizado para otros tests",
              "pm.test(\"Guardar ID y username actualizados en variables\", function () {",
              "    if (typeof data.id !== \"undefined\") {",
              "        pm.environment.set(\"USER_USER_ID\", data.id);",
              "        pm.collectionVariables.set(\"USER_USER_ID\", data.id);",
              "    }",
              "    if (typeof data.username === \"string\") {",
              "        pm.environment.set(\"USER_USER_USERNAME\", data.username);",
              "        pm.collectionVariables.set(\"USER_USER_USERNAME\", data.username);",
              "    }",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "PUT",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"username\": \"usuario_prueba_123_actualizado\",\n    \"email\": \"prueba.actualizada@ejemplo.com\",\n    \"first_name\": \"Juanito\",\n    \"last_name\": \"P√©rez G√≥mez\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{LOCAL}}/users/me/update/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            "me",
            "update",
            ""
          ]
        },
        "description": "TODO: Verificar en aplicacion"
      },
      "response": []
    },
    {
      "name": "Delete_User",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login y obtenci√≥n de tokens ===\");",
              "",
              "// Configuraci√≥n b√°sica",
              "const baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"LOCAL\");",
              "const username = pm.environment.get(\"SUDOUSERNAME\") || pm.globals.get(\"SUDOUSERNAME\");",
              "const password = pm.environment.get(\"SUDOUSERPASS\") || pm.globals.get(\"SUDOUSERPASS\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(\"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\");",
              "}",
              "if (!username || !password) {",
              "    throw new Error(\"Variables SUDOUSERNAME o SUDOUSERPASS no est√°n definidas.\");",
              "}",
              "",
              "const loginUrl = baseUrl.replace(/\\/+$/, \"\") + \"/token/\"; // o \"/api/token/\" seg√∫n tu backend",
              "",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: username,",
              "            password: password",
              "        })",
              "    }",
              "};",
              "",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login:\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login:\", loginData);",
              "        throw new Error(\"La respuesta de login no contiene 'access' y/o 'refresh'.\");",
              "    }",
              "",
              "    // Guardar tokens para otros requests, si los necesitas",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    // Asegurar solo headers, NO tocar el body",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // ‚ö† NO actualizar el body aqu√≠, dejamos el body inv√°lido que seteaste t√∫ a mano",
              "    // pm.request.body.update({ ... });",
              "",
              "    console.log(\"‚úì Login OK. Usando body de refresh tal como est√° configurado en el request (deber√≠a ser inv√°lido).\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "DELETE",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": ""
        },
        "url": {
          "raw": "{{LOCAL}}/users/{{USER_USER_ID}}/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            "{{USER_USER_ID}}",
            ""
          ]
        }
      },
      "response": []
    },
    {
      "name": "Creat_User_User2",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login y obtenci√≥n de tokens ===\");",
              "",
              "// Configuraci√≥n b√°sica",
              "const baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"LOCAL\");",
              "const username = pm.environment.get(\"SUDOUSERNAME\") || pm.globals.get(\"SUDOUSERNAME\");",
              "const password = pm.environment.get(\"SUDOUSERPASS\") || pm.globals.get(\"SUDOUSERPASS\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(\"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\");",
              "}",
              "if (!username || !password) {",
              "    throw new Error(\"Variables SUDOUSERNAME o SUDOUSERPASS no est√°n definidas.\");",
              "}",
              "",
              "const loginUrl = baseUrl.replace(/\\/+$/, \"\") + \"/token/\"; // o \"/api/token/\" seg√∫n tu backend",
              "",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: username,",
              "            password: password",
              "        })",
              "    }",
              "};",
              "",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login:\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login:\", loginData);",
              "        throw new Error(\"La respuesta de login no contiene 'access' y/o 'refresh'.\");",
              "    }",
              "",
              "    // Guardar tokens para otros requests, si los necesitas",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    // Asegurar solo headers, NO tocar el body",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // ‚ö† NO actualizar el body aqu√≠, dejamos el body inv√°lido que seteaste t√∫ a mano",
              "    // pm.request.body.update({ ... });",
              "",
              "    console.log(\"‚úì Login OK. Usando body de refresh tal como est√° configurado en el request (deber√≠a ser inv√°lido).\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// ============================================",
              "// TEST: Crear usuario y capturar USER_USER_ID autom√°ticamente",
              "// ============================================",
              "",
              "let responseData;",
              "",
              "pm.test(\"Status code es 201 Created\", function () {",
              "  pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test(\"Respuesta es JSON v√°lido (sin campo id)\", function () {",
              "  responseData = pm.response.json();",
              "  pm.expect(responseData).to.be.an(\"object\");",
              "",
              "  pm.expect(responseData).to.have.property(\"username\");",
              "  pm.expect(responseData).to.have.property(\"email\");",
              "  pm.expect(responseData).to.have.property(\"role\");",
              "  pm.expect(responseData).to.have.property(\"first_name\");",
              "  pm.expect(responseData).to.have.property(\"last_name\");",
              "",
              "  pm.expect(responseData).to.not.have.property(\"id\");",
              "});",
              "",
              "// 1) Guardar username creado",
              "pm.test(\"Guardar CREATED_USERNAME\", function () {",
              "  const username = responseData.username;",
              "  pm.environment.set(\"CREATED_USERNAME\", username);",
              "  pm.collectionVariables.set(\"CREATED_USERNAME\", username);",
              "  console.log(\"‚úÖ CREATED_USERNAME guardado:\", username);",
              "});",
              "",
              "// 2) Buscar el usuario por username y guardar USER_USER_ID",
              "// Ajusta searchUrl si tu backend usa otro path (por ejemplo /api/users/)",
              "(function captureIdAfterCreate() {",
              "  const base = pm.environment.get(\"base_url\") || pm.environment.get(\"LOCAL\") || pm.globals.get(\"LOCAL\");",
              "  if (!base) {",
              "    console.warn(\"‚ö†Ô∏è No hay base_url/LOCAL definido. No se puede buscar el ID.\");",
              "    return;",
              "  }",
              "",
              "  const createdUsername = pm.environment.get(\"CREATED_USERNAME\") || pm.collectionVariables.get(\"CREATED_USERNAME\");",
              "  if (!createdUsername) {",
              "    console.warn(\"‚ö†Ô∏è No se pudo leer CREATED_USERNAME.\");",
              "    return;",
              "  }",
              "",
              "  // Intenta con endpoint con filtro. Cambia a tu ruta real si difiere:",
              "  // Ejemplos:",
              "  //   `${base.replace(/\\/+$/,'')}/users/?username=${encodeURIComponent(createdUsername)}`",
              "  //   `${base.replace(/\\/+$/,'')}/api/users/?username=${encodeURIComponent(createdUsername)}`",
              "  const searchUrl = `${base.replace(/\\/+$/,'')}/users/?username=${encodeURIComponent(createdUsername)}`;",
              "",
              "  pm.sendRequest({",
              "    url: searchUrl,",
              "    method: \"GET\",",
              "    header: {",
              "      \"Accept\": \"application/json\",",
              "      // Si tu API requiere auth, a√±ade el Bearer del login previo:",
              "      ...(pm.environment.get(\"access_token\") ? { \"Authorization\": `Bearer ${pm.environment.get(\"access_token\")}` } : {})",
              "    }",
              "  }, function (err, res) {",
              "    if (err) {",
              "      console.error(\"‚ùå Error buscando usuario por username:\", err);",
              "      return;",
              "    }",
              "",
              "    if (res.code !== 200) {",
              "      console.error(\"‚ùå B√∫squeda de usuario no devolvi√≥ 200. C√≥digo:\", res.code, \"Body:\", res.text());",
              "      return;",
              "    }",
              "",
              "    let list;",
              "    try {",
              "      list = res.json();",
              "    } catch (e) {",
              "      console.error(\"‚ùå Respuesta de b√∫squeda no es JSON:\", res.text());",
              "      return;",
              "    }",
              "",
              "    // Algunas APIs devuelven objeto {results:[...]} en vez de array directo",
              "    if (Array.isArray(list) === false && Array.isArray(list.results)) {",
              "      list = list.results;",
              "    }",
              "",
              "    if (!Array.isArray(list) || list.length === 0) {",
              "      console.error(\"‚ùå No se encontraron usuarios al filtrar por username:\", createdUsername, \"Respuesta:\", list);",
              "      return;",
              "    }",
              "",
              "    const found = list.find(u => u && u.username === createdUsername);",
              "    if (!found) {",
              "      console.error(\"‚ùå No se encontr√≥ el usuario exacto en la lista. Lista:\", list);",
              "      return;",
              "    }",
              "",
              "    if (typeof found.id === \"undefined\" || found.id === null) {",
              "      console.error(\"‚ùå El usuario encontrado no tiene 'id'. Usuario:\", found);",
              "      return;",
              "    }",
              "",
              "    pm.environment.set(\"USER_USER_ID\", found.id);",
              "    pm.collectionVariables.set(\"USER_USER_ID\", found.id);",
              "    console.log(\"‚úÖ USER_USER_ID capturado autom√°ticamente:\", found.id);",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"username\": \"usuario_prueba_321\",\n    \"email\": \"prueba@ejemplo.com\",\n    \"password\": \"Contrase√±aSegura123!\",\n    \"password_confirm\": \"Contrase√±aSegura123!\",\n    \"role\": \"USER\",\n    \"first_name\": \"Juan\",\n    \"last_name\": \"P√©rez\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{LOCAL}}/users/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            ""
          ]
        },
        "description": "Crea el mismo usuario de nuevo por temas de facilidad"
      },
      "response": []
    },
    {
      "name": "Get_User_User_By_Id",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login y obtenci√≥n de tokens ===\");",
              "",
              "// Configuraci√≥n b√°sica",
              "const baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"LOCAL\");",
              "const username = pm.environment.get(\"SUDOUSERNAME\") || pm.globals.get(\"SUDOUSERNAME\");",
              "const password = pm.environment.get(\"SUDOUSERPASS\") || pm.globals.get(\"SUDOUSERPASS\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(\"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\");",
              "}",
              "if (!username || !password) {",
              "    throw new Error(\"Variables SUDOUSERNAME o SUDOUSERPASS no est√°n definidas.\");",
              "}",
              "",
              "const loginUrl = baseUrl.replace(/\\/+$/, \"\") + \"/token/\"; // o \"/api/token/\" seg√∫n tu backend",
              "",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: username,",
              "            password: password",
              "        })",
              "    }",
              "};",
              "",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login:\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login:\", loginData);",
              "        throw new Error(\"La respuesta de login no contiene 'access' y/o 'refresh'.\");",
              "    }",
              "",
              "    // Guardar tokens para otros requests, si los necesitas",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    // Asegurar solo headers, NO tocar el body",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // ‚ö† NO actualizar el body aqu√≠, dejamos el body inv√°lido que seteaste t√∫ a mano",
              "    // pm.request.body.update({ ... });",
              "",
              "    console.log(\"‚úì Login OK. Usando body de refresh tal como est√° configurado en el request (deber√≠a ser inv√°lido).\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// ============================================",
              "// TEST: Obtener usuario por ID (mejorado)",
              "// ============================================",
              "",
              "console.log(\"=== Test: Obtener usuario por ID ===\");",
              "",
              "// 1. Status 200 OK",
              "pm.test(\"Status code es 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "// 2. Respuesta es JSON v√°lido",
              "let user;",
              "try {",
              "    user = pm.response.json();",
              "    pm.test(\"Respuesta es JSON v√°lido\", function () {",
              "        pm.expect(user).to.be.an(\"object\");",
              "    });",
              "} catch (e) {",
              "    pm.test(\"Respuesta es JSON v√°lido\", function () {",
              "        pm.expect.fail(\"La respuesta no es JSON v√°lido: \" + e.message);",
              "    });",
              "}",
              "",
              "// 3. Estructura b√°sica del usuario (versi√≥n m√°s robusta)",
              "pm.test(\"Respuesta tiene campos b√°sicos del usuario\", function () {",
              "    if (!user) return; // Si no hay user, el test anterior ya fall√≥",
              "    ",
              "    // Campos obligatorios",
              "    const requiredFields = [",
              "        \"id\",",
              "        \"username\", ",
              "        \"email\",",
              "        \"first_name\",",
              "        \"last_name\",",
              "        \"role\",",
              "        \"is_email_confirmed\",",
              "        \"is_active\",",
              "        \"date_joined\"",
              "    ];",
              "    ",
              "    requiredFields.forEach(field => {",
              "        pm.expect(user, `Campo '${field}' no encontrado`).to.have.property(field);",
              "    });",
              "    ",
              "    // Campos opcionales (solo verificamos si existen)",
              "    const optionalFields = [",
              "        \"is_staff\",",
              "        \"is_superuser\", ",
              "        \"last_login\",",
              "        \"nodes_created_count\"",
              "    ];",
              "    ",
              "    optionalFields.forEach(field => {",
              "        if (user.hasOwnProperty(field)) {",
              "            console.log(`‚úÖ Campo opcional '${field}' presente`);",
              "        }",
              "    });",
              "});",
              "",
              "// 4. Tipos de datos correctos (versi√≥n mejorada)",
              "pm.test(\"Tipos de datos del usuario son correctos\", function () {",
              "    if (!user) return;",
              "    ",
              "    // Tipos esperados",
              "    const expectedTypes = {",
              "        \"id\": \"number\",",
              "        \"username\": \"string\",",
              "        \"email\": \"string\", ",
              "        \"first_name\": \"string\",",
              "        \"last_name\": \"string\",",
              "        \"role\": \"string\",",
              "        \"is_email_confirmed\": \"boolean\",",
              "        \"is_active\": \"boolean\",",
              "        \"date_joined\": \"string\"",
              "    };",
              "    ",
              "    Object.entries(expectedTypes).forEach(([field, expectedType]) => {",
              "        if (user[field] !== undefined) {",
              "            pm.expect(user[field], `Campo '${field}' tiene tipo incorrecto`).to.be.a(expectedType);",
              "        }",
              "    });",
              "    ",
              "    // Campos opcionales con tipos espec√≠ficos",
              "    if (user.hasOwnProperty(\"is_staff\")) {",
              "        pm.expect(user.is_staff).to.be.a(\"boolean\");",
              "    }",
              "    ",
              "    if (user.hasOwnProperty(\"is_superuser\")) {",
              "        pm.expect(user.is_superuser).to.be.a(\"boolean\");",
              "    }",
              "    ",
              "    if (user.hasOwnProperty(\"nodes_created_count\")) {",
              "        pm.expect(user.nodes_created_count).to.be.a(\"number\");",
              "    }",
              "    ",
              "    // last_login puede ser null o string",
              "    if (user.last_login !== null && user.last_login !== undefined) {",
              "        pm.expect(user.last_login).to.be.a(\"string\");",
              "    }",
              "});",
              "",
              "// 5. Validaci√≥n de username adaptable (MEJORADO)",
              "pm.test(\"Validaci√≥n del usuario obtenido\", function () {",
              "    if (!user) return;",
              "    ",
              "    const expectedUsername = pm.variables.get(\"EXPECTED_USERNAME\");",
              "    const expectedEmail = pm.variables.get(\"EXPECTED_EMAIL\");",
              "    const expectedId = pm.variables.get(\"EXPECTED_USER_ID\");",
              "    ",
              "    console.log(\"üîç Validando usuario:\");",
              "    console.log(`   Username actual: \"${user.username}\"`);",
              "    console.log(`   Email actual: \"${user.email}\"`);",
              "    console.log(`   ID actual: ${user.id}`);",
              "    ",
              "    // Verificar username",
              "    if (expectedUsername) {",
              "        console.log(`   Username esperado: \"${expectedUsername}\"`);",
              "        pm.expect(user.username).to.equal(expectedUsername);",
              "    } else {",
              "        console.log(\"   ‚ö† No hay EXPECTED_USERNAME definida\");",
              "        // Verificar que username no est√© vac√≠o",
              "        pm.expect(user.username).to.be.a(\"string\").that.is.not.empty;",
              "    }",
              "    ",
              "    // Verificar email (opcional)",
              "    if (expectedEmail) {",
              "        console.log(`   Email esperado: \"${expectedEmail}\"`);",
              "        pm.expect(user.email).to.equal(expectedEmail);",
              "    }",
              "    ",
              "    // Verificar ID (opcional)",
              "    if (expectedId) {",
              "        console.log(`   ID esperado: ${expectedId}`);",
              "        pm.expect(user.id).to.equal(parseInt(expectedId));",
              "    }",
              "});",
              "",
              "// 6. Validaciones espec√≠ficas de negocio",
              "pm.test(\"Validaciones espec√≠ficas del dominio\", function () {",
              "    if (!user) return;",
              "    ",
              "    // El email debe ser v√°lido",
              "    pm.expect(user.email).to.match(/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/);",
              "    ",
              "    // El role debe ser uno de los permitidos",
              "    const validRoles = [\"USER\", \"ADMIN\", \"MODERATOR\", \"SUPERUSER\"];",
              "    pm.expect(validRoles).to.include(user.role);",
              "    ",
              "    // Usuario de prueba no deber√≠a ser staff ni superuser",
              "    if (user.username.includes(\"prueba\") || user.username.includes(\"test\")) {",
              "        console.log(\"üë§ Usuario identificado como de prueba\");",
              "        pm.expect(user.is_staff).to.be.false;",
              "        pm.expect(user.is_superuser).to.be.false;",
              "        pm.expect(user.role).to.equal(\"USER\");",
              "    }",
              "});",
              "",
              "// 7. Guardar datos √∫tiles (versi√≥n mejorada)",
              "pm.test(\"Guardar datos del usuario para uso posterior\", function () {",
              "    if (!user) return;",
              "    ",
              "    // Solo guardar si no estamos en modo solo lectura",
              "    const isReadOnly = pm.variables.get(\"READ_ONLY_MODE\") === \"true\";",
              "    ",
              "    if (!isReadOnly) {",
              "        pm.environment.set(\"USER_USER_ID\", user.id);",
              "        pm.environment.set(\"USER_USERNAME\", user.username);",
              "        pm.environment.set(\"USER_EMAIL\", user.email);",
              "        pm.environment.set(\"USER_FIRST_NAME\", user.first_name);",
              "        pm.environment.set(\"USER_LAST_NAME\", user.last_name);",
              "        pm.environment.set(\"USER_ROLE\", user.role);",
              "        ",
              "        console.log(\"üíæ Datos guardados en variables de entorno:\");",
              "        console.log(`   ID: ${user.id}`);",
              "        console.log(`   Username: ${user.username}`);",
              "        console.log(`   Email: ${user.email}`);",
              "        console.log(`   Role: ${user.role}`);",
              "    } else {",
              "        console.log(\"üìñ Modo solo lectura - no se guardan variables\");",
              "    }",
              "});",
              "",
              "// 8. Verificaciones adicionales de consistencia",
              "pm.test(\"Consistencia de datos del usuario\", function () {",
              "    if (!user) return;",
              "    ",
              "    // date_joined debe ser una fecha ISO v√°lida",
              "    const dateJoined = new Date(user.date_joined);",
              "    pm.expect(dateJoined.toString()).to.not.equal(\"Invalid Date\");",
              "    ",
              "    // last_login debe ser null o fecha ISO v√°lida",
              "    if (user.last_login !== null && user.last_login !== undefined) {",
              "        const lastLogin = new Date(user.last_login);",
              "        pm.expect(lastLogin.toString()).to.not.equal(\"Invalid Date\");",
              "        ",
              "        // last_login no puede ser anterior a date_joined",
              "        pm.expect(lastLogin.getTime()).to.be.at.least(dateJoined.getTime());",
              "    }",
              "    ",
              "    // nodes_created_count no puede ser negativo",
              "    if (user.hasOwnProperty(\"nodes_created_count\")) {",
              "        pm.expect(user.nodes_created_count).to.be.at.least(0);",
              "    }",
              "});",
              "",
              "// 9. Debug: Mostrar informaci√≥n completa",
              "console.log(\"\\n\" + \"=\".repeat(50));",
              "console.log(\"üìä RESUMEN DEL USUARIO OBTENIDO:\");",
              "console.log(\"=\".repeat(50));",
              "Object.entries(user || {}).forEach(([key, value]) => {",
              "    const formattedValue = value === null ? \"null\" : value;",
              "    console.log(`  ${key}: ${formattedValue}`);",
              "});",
              "console.log(\"=\".repeat(50));",
              "",
              "// 10. Test de rendimiento",
              "pm.test(\"Tiempo de respuesta aceptable\", function () {",
              "    pm.expect(pm.response.responseTime).to.be.below(500);",
              "    console.log(`‚è± Tiempo de respuesta: ${pm.response.responseTime}ms`);",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": ""
        },
        "url": {
          "raw": "{{LOCAL}}/users/{{USER_USER_ID}}/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            "{{USER_USER_ID}}",
            ""
          ]
        }
      },
      "response": []
    },
    {
      "name": "Update_User_User",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login y obtenci√≥n de tokens ===\");",
              "",
              "// Configuraci√≥n b√°sica",
              "const baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"LOCAL\");",
              "const username = pm.environment.get(\"SUDOUSERNAME\") || pm.globals.get(\"SUDOUSERNAME\");",
              "const password = pm.environment.get(\"SUDOUSERPASS\") || pm.globals.get(\"SUDOUSERPASS\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(\"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\");",
              "}",
              "if (!username || !password) {",
              "    throw new Error(\"Variables SUDOUSERNAME o SUDOUSERPASS no est√°n definidas.\");",
              "}",
              "",
              "const loginUrl = baseUrl.replace(/\\/+$/, \"\") + \"/token/\"; // o \"/api/token/\" seg√∫n tu backend",
              "",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: username,",
              "            password: password",
              "        })",
              "    }",
              "};",
              "",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login:\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login:\", loginData);",
              "        throw new Error(\"La respuesta de login no contiene 'access' y/o 'refresh'.\");",
              "    }",
              "",
              "    // Guardar tokens para otros requests, si los necesitas",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    // Asegurar solo headers, NO tocar el body",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // ‚ö† NO actualizar el body aqu√≠, dejamos el body inv√°lido que seteaste t√∫ a mano",
              "    // pm.request.body.update({ ... });",
              "",
              "    console.log(\"‚úì Login OK. Usando body de refresh tal como est√° configurado en el request (deber√≠a ser inv√°lido).\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// ============================================",
              "// TEST: Actualizar usuario por PATCH (AJUSTADO)",
              "// ============================================",
              "",
              "console.log(\"=== Test: Actualizar usuario por PATCH ===\");",
              "",
              "// 1. Status puede ser 200 OK o 204 No Content",
              "pm.test(\"Status code es exitoso\", function () {",
              "    // Acepta 200, 204, o incluso 200/201 dependiendo de tu API",
              "    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
              "});",
              "",
              "// 2. Manejar diferentes tipos de respuesta",
              "const requestData = JSON.parse(pm.request.body.raw || \"{}\");",
              "console.log(\"üìù Datos enviados para actualizaci√≥n:\", requestData);",
              "",
              "// 3. Si la respuesta es 204 No Content",
              "if (pm.response.code === 204) {",
              "    console.log(\"‚úì Respuesta 204 No Content - actualizaci√≥n exitosa sin cuerpo\");",
              "    ",
              "    pm.test(\"Actualizaci√≥n exitosa con 204\", function () {",
              "        pm.expect(pm.response.body).to.be.empty;",
              "    });",
              "    ",
              "    // Guardar que la actualizaci√≥n fue exitosa",
              "    pm.environment.set(\"UPDATE_SUCCESS\", \"true\");",
              "    ",
              "} else {",
              "    // 4. Si la respuesta es 200 con JSON",
              "    let responseData;",
              "    try {",
              "        responseData = pm.response.json();",
              "        console.log(\"üì¶ Respuesta recibida:\", responseData);",
              "        ",
              "        pm.test(\"Respuesta es JSON v√°lido\", function () {",
              "            pm.expect(responseData).to.be.an(\"object\");",
              "        });",
              "        ",
              "        // 5. Verificar SOLO si los campos actualizados est√°n en la respuesta",
              "        pm.test(\"Los campos enviados se reflejan en la respuesta\", function () {",
              "            Object.keys(requestData).forEach(field => {",
              "                // Solo verificar si el campo est√° presente en la respuesta",
              "                if (responseData.hasOwnProperty(field)) {",
              "                    console.log(`   ‚úÖ Campo '${field}' actualizado:`, responseData[field]);",
              "                    pm.expect(responseData[field]).to.eql(requestData[field]);",
              "                } else {",
              "                    console.log(`   ‚Ñπ Campo '${field}' no est√° en la respuesta (puede ser normal)`);",
              "                }",
              "            });",
              "        });",
              "        ",
              "        // 6. Guardar ID si est√° en la respuesta",
              "        if (responseData.id) {",
              "            pm.environment.set(\"UPDATED_USER_ID\", responseData.id);",
              "        }",
              "        ",
              "        // 7. Guardar el campo actualizado si est√° en la respuesta",
              "        if (requestData.first_name && responseData.first_name) {",
              "            pm.environment.set(\"UPDATED_FIRST_NAME\", responseData.first_name);",
              "            console.log(`üíæ First name actualizado guardado: ${responseData.first_name}`);",
              "        }",
              "        ",
              "    } catch (e) {",
              "        console.log(\"‚ö† Respuesta no es JSON o est√° vac√≠a:\", pm.response.text());",
              "        ",
              "        // Si no es JSON pero fue 200, puede ser OK",
              "        if (pm.response.code === 200) {",
              "            pm.test(\"Actualizaci√≥n exitosa (200 OK)\", function () {",
              "                pm.expect(pm.response.code).to.equal(200);",
              "            });",
              "        }",
              "    }",
              "}",
              "",
              "// 8. Test de rendimiento (siempre aplica)",
              "pm.test(\"Tiempo de respuesta aceptable\", function () {",
              "    pm.expect(pm.response.responseTime).to.be.below(2000);",
              "    console.log(`‚è± Tiempo de respuesta: ${pm.response.responseTime}ms`);",
              "});",
              "",
              "// 9. Verificar que la actualizaci√≥n fue procesada",
              "pm.test(\"La solicitud PATCH fue procesada\", function () {",
              "    // Si llegamos aqu√≠ sin errores, la solicitud fue procesada",
              "    pm.expect(pm.response.code).to.not.equal(400);",
              "    pm.expect(pm.response.code).to.not.equal(401);",
              "    pm.expect(pm.response.code).to.not.equal(403);",
              "    pm.expect(pm.response.code).to.not.equal(404);",
              "    pm.expect(pm.response.code).to.not.equal(500);",
              "});",
              "",
              "// 10. Opcional: Verificar haciendo un GET despu√©s",
              "console.log(\"\\nüí° Consejo: Para verificar completamente, haz un GET /users/me/ despu√©s\");"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "PUT",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"first_name\": \"user1\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{LOCAL}}/users/{{USER_USER_ID}}/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            "{{USER_USER_ID}}",
            ""
          ]
        }
      },
      "response": []
    },
    {
      "name": "Delete_User_By_Id",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "console.log(\"=== Pre-request: Login y obtenci√≥n de tokens ===\");",
              "",
              "// Configuraci√≥n b√°sica",
              "const baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"LOCAL\");",
              "const username = pm.environment.get(\"SUDOUSERNAME\") || pm.globals.get(\"SUDOUSERNAME\");",
              "const password = pm.environment.get(\"SUDOUSERPASS\") || pm.globals.get(\"SUDOUSERPASS\");",
              "",
              "if (!baseUrl) {",
              "    throw new Error(\"No se encontr√≥ 'base_url' ni 'LOCAL'. Configura una de estas variables (ej: http://localhost:8000).\");",
              "}",
              "if (!username || !password) {",
              "    throw new Error(\"Variables SUDOUSERNAME o SUDOUSERPASS no est√°n definidas.\");",
              "}",
              "",
              "const loginUrl = baseUrl.replace(/\\/+$/, \"\") + \"/token/\"; // o \"/api/token/\" seg√∫n tu backend",
              "",
              "const loginRequest = {",
              "    url: loginUrl,",
              "    method: \"POST\",",
              "    header: {",
              "        \"Content-Type\": \"application/json\",",
              "        \"Accept\": \"application/json\"",
              "    },",
              "    body: {",
              "        mode: \"raw\",",
              "        raw: JSON.stringify({",
              "            username: username,",
              "            password: password",
              "        })",
              "    }",
              "};",
              "",
              "pm.sendRequest(loginRequest, function (err, response) {",
              "    if (err) {",
              "        console.error(\"Error en login:\", err);",
              "        throw new Error(\"No se pudo obtener tokens: \" + err.message);",
              "    }",
              "",
              "    if (response.code !== 200) {",
              "        console.log(\"Body login:\", response.text());",
              "        throw new Error(\"Login fall√≥. C√≥digo: \" + response.code);",
              "    }",
              "",
              "    let loginData;",
              "    try {",
              "        loginData = response.json();",
              "    } catch (e) {",
              "        throw new Error(\"La respuesta de login no es JSON v√°lido.\");",
              "    }",
              "",
              "    if (!loginData.access || !loginData.refresh) {",
              "        console.log(\"Body login:\", loginData);",
              "        throw new Error(\"La respuesta de login no contiene 'access' y/o 'refresh'.\");",
              "    }",
              "",
              "    // Guardar tokens para otros requests, si los necesitas",
              "    pm.environment.set(\"access_token\", loginData.access);",
              "    pm.environment.set(\"refresh_token\", loginData.refresh);",
              "    pm.environment.set(\"temp_access_token\", loginData.access);",
              "    pm.environment.set(\"temp_refresh_token\", loginData.refresh);",
              "",
              "    // Asegurar solo headers, NO tocar el body",
              "    pm.request.headers.upsert({",
              "        key: \"Content-Type\",",
              "        value: \"application/json\"",
              "    });",
              "    pm.request.headers.upsert({",
              "        key: \"Accept\",",
              "        value: \"application/json\"",
              "    });",
              "",
              "    // ‚ö† NO actualizar el body aqu√≠, dejamos el body inv√°lido que seteaste t√∫ a mano",
              "    // pm.request.body.update({ ... });",
              "",
              "    console.log(\"‚úì Login OK. Usando body de refresh tal como est√° configurado en el request (deber√≠a ser inv√°lido).\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "// ============================================",
              "// TEST: Eliminar usuario de pruebas ({{USER_USER_ID}})",
              "// ============================================",
              "",
              "console.log(\"=== Test: Delete usuario de pruebas ===\");",
              "",
              "// 1. C√≥digo de estado esperado (ajusta si tu API devuelve otro)",
              "pm.test(\"Status code es 204 o 200\", function () {",
              "    pm.expect([200, 204]).to.include(pm.response.code);",
              "});",
              "",
              "// 2. Si devuelve 204, el cuerpo deber√≠a estar vac√≠o",
              "pm.test(\"Si status es 204, el cuerpo est√° vac√≠o\", function () {",
              "    if (pm.response.code === 204) {",
              "        pm.expect(pm.response.text()).to.be.oneOf([\"\", \" \", null, undefined]);",
              "    }",
              "});",
              "",
              "// 3. Si devuelve 200 con JSON, validamos estructura b√°sica (opcional, depende de tu API)",
              "pm.test(\"Si status es 200, respuesta v√°lida\", function () {",
              "    if (pm.response.code === 200) {",
              "        let body;",
              "        try {",
              "            body = pm.response.json();",
              "            pm.expect(body).to.be.an(\"object\");",
              "        } catch (e) {",
              "            // Si no es JSON, lo dejamos como info",
              "            console.warn(\"Respuesta 200 no es JSON, saltando validaci√≥n de cuerpo\");",
              "        }",
              "    }",
              "});",
              "",
              "// 4. (Opcional) Marcar en variables que el usuario fue eliminado",
              "pm.test(\"Marcar usuario como eliminado en variables\", function () {",
              "    const deletedId = pm.variables.get(\"USER_USER_ID\");",
              "    if (deletedId) {",
              "        pm.environment.set(\"LAST_DELETED_USER_ID\", deletedId);",
              "        pm.collectionVariables.set(\"LAST_DELETED_USER_ID\", deletedId);",
              "    }",
              "});",
              "",
              "// 5. (Recomendado) Verificar en un siguiente request que ya no existe",
              "//    Esto se hace en otro request GET, usando esta marca:",
              "pm.test(\"Sugerencia: valida en un GET que el usuario ya no existe\", function () {",
              "    // Este test siempre pasa; es un recordatorio de flujo",
              "    pm.expect(true).to.be.true;",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "DELETE",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"first_name\": \"user1\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{LOCAL}}/users/{{USER_USER_ID}}/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            "{{USER_USER_ID}}",
            ""
          ]
        }
      },
      "response": []
    },
    {
      "name": "Nodes_By_SUDO",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": ""
        },
        "url": {
          "raw": "{{LOCAL}}/users/1/nodes-created/",
          "host": [
            "{{LOCAL}}"
          ],
          "path": [
            "users",
            "1",
            "nodes-created",
            ""
          ]
        }
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "USER_USER_ID",
      "value": ""
    },
    {
      "key": "USER_USER_USERNAME",
      "value": ""
    },
    {
      "key": "ADMIN_ID",
      "value": ""
    },
    {
      "key": "ADMIN_USERNAME",
      "value": ""
    },
    {
      "key": "ADMIN_EMAIL",
      "value": ""
    },
    {
      "key": "USER_USERNAME",
      "value": ""
    },
    {
      "key": "USER_EMAIL",
      "value": ""
    },
    {
      "key": "CREATED_USERNAME",
      "value": ""
    },
    {
      "key": "LAST_DELETED_USER_ID",
      "value": ""
    }
  ]
}